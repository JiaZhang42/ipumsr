<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Value Labels • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Value Labels">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipums.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-geography.html">Geographic data in ipumsr</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li>
      <a href="../articles/ipums-api.html">IPUMS data extract API</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/ipums-cps.html">CPS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-nhgis.html">NHGIS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-terra.html">IPUMS Terra exercise</a>
    </li>
    <li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">More project exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Value Labels</h1>
                        <h4 data-toc-skip class="author">Minnesota
Population Center</h4>
            
            <h4 data-toc-skip class="date">2022-06-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/value-labels.Rmd" class="external-link"><code>vignettes/value-labels.Rmd</code></a></small>
      <div class="hidden name"><code>value-labels.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="value-labels-in-the-ipumsr-package">Value labels in the ipumsr package<a class="anchor" aria-label="anchor" href="#value-labels-in-the-ipumsr-package"></a>
</h2>
<p>Integrated variables in IPUMS data often have value labels, which
attach text labels to the values taken by a variable (for example the
HEALTH variable has value labels: 1 = “Excellent”, 2 = “Very good”,
etc.). The <code>ipumsr</code> package does import the labels, but not
as factors, which may be how you were expecting them.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.ipums.org" class="external-link">ipumsr</a></span><span class="op">)</span>
<span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="fu"><a href="../reference/ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"cps_00015.xml"</span><span class="op">)</span><span class="op">)</span>
<span class="va">cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="va">cps</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 10,883 × 13</span></span>
<span class="co">#&gt;     YEAR SERIAL HWTSUPP  STATEFIP ASECFLAG   MONTH PERNUM WTSUPP   AGE      EDUC</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lb&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+l&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int+lbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>138   <span style="text-decoration: underline;">3</span>249. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      1  <span style="text-decoration: underline;">3</span>249.    54  73<span style="color: #949494;"> [Hig…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>139   <span style="text-decoration: underline;">3</span>154. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      1  <span style="text-decoration: underline;">3</span>154.    54  73<span style="color: #949494;"> [Hig…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>139   <span style="text-decoration: underline;">3</span>154. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      2  <span style="text-decoration: underline;">3</span>154.    52  73<span style="color: #949494;"> [Hig…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140   <span style="text-decoration: underline;">1</span>652. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      1  <span style="text-decoration: underline;">1</span>652.    38  60<span style="color: #949494;"> [Gra…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140   <span style="text-decoration: underline;">1</span>652. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      2  <span style="text-decoration: underline;">1</span>503.    15  10<span style="color: #949494;"> [Gra…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>140   <span style="text-decoration: underline;">1</span>652. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      3  <span style="text-decoration: underline;">1</span>652.    38  73<span style="color: #949494;"> [Hig…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>141   <span style="text-decoration: underline;">3</span>049. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      1  <span style="text-decoration: underline;">3</span>049.    85  30<span style="color: #949494;"> [Gra…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142   <span style="text-decoration: underline;">1</span>637. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      1  <span style="text-decoration: underline;">1</span>637.    27 111<span style="color: #949494;"> [Bac…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142   <span style="text-decoration: underline;">1</span>637. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      2  <span style="text-decoration: underline;">1</span>637.    27 111<span style="color: #949494;"> [Bac…</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>  <span style="text-decoration: underline;">2</span>016  <span style="text-decoration: underline;">24</span>142   <span style="text-decoration: underline;">1</span>637. 55<span style="color: #949494;"> [Wisc…</span> 1<span style="color: #949494;"> [ASEC]</span> 3<span style="color: #949494;"> [Mar…</span>      3  <span style="text-decoration: underline;">1</span>887.     2   1<span style="color: #949494;"> [NIU…</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 10,873 more rows, and 3 more variables: INCTOT &lt;dbl+lbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   HEALTH &lt;int+lbl&gt;, MIGRATE1 &lt;int+lbl&gt;</span></span></code></pre></div>
<p>The first clue that some of the variables are labelled is the
<code>&lt;dbl+lbl&gt;</code> that appear below <code>STATEFIP</code>,
<code>ASECFLAG</code> and other variables. The tibble package prints the
variable’s type information below the variable name, and this “+lbl”
indicates that the variable uses the <code>labelled</code> type. The
function <code><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">is.labelled()</a></code> will also tell you if a variable is
labelled.</p>
<p>By default the ipumsr package now will attempt to show the value
labels when printing out a data.frame (like the <code>"[Wis~"</code> on
STATEFIP above, for Wisconsin). If your console supports colorful
output, then the labels will be in a lighter gray than the values. You
can turn off this printing behavior by setting the option
<code>options("ipumsr.show_pillar_labels" = FALSE)</code>)</p>
<p>However, as you can see, there often isn’t enough space to see the
labels when printing out a full data.frame. So, there are a few options
to see the labels directly:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Printing the variable directly (or a subset)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span>
<span class="co">#&gt; &lt;labelled&lt;integer&gt;[6]&gt;: Month</span>
<span class="co">#&gt; [1] 3 3 3 3 3 3</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:</span>
<span class="co">#&gt;  value     label</span>
<span class="co">#&gt;      1   January</span>
<span class="co">#&gt;      2  February</span>
<span class="co">#&gt;      3     March</span>
<span class="co">#&gt;      4     April</span>
<span class="co">#&gt;      5       May</span>
<span class="co">#&gt;      6      June</span>
<span class="co">#&gt;      7      July</span>
<span class="co">#&gt;      8    August</span>
<span class="co">#&gt;      9 September</span>
<span class="co">#&gt;     10   October</span>
<span class="co">#&gt;     11  November</span>
<span class="co">#&gt;     12  December</span>

<span class="co"># Just get the labels</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 2</span></span>
<span class="co">#&gt;      val lbl      </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 January  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 February </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     3 March    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     4 April    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     5 May      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     6 June     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     7 July     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     8 August   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     9 September</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    10 October  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    11 November </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    12 December</span>

<span class="co"># or if you're working interactively you can use ipums_view</span>
<span class="co"># ipums_view(ddi)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="why-use-the-labelled-class-instead-of-base-rs-factors">Why use the labelled class instead of base R’s factors?<a class="anchor" aria-label="anchor" href="#why-use-the-labelled-class-instead-of-base-rs-factors"></a>
</h2>
<p>The usual way to connect numeric data to labels in R is in
<code>factor</code> variables. Though this data type is more native to
R, and more widely supported by R code, it was designed for efficient
calculations in linear models, not as a general purpose value labeling
system and so is missing important features that the value labels
provided by IPUMS require.</p>
<p>Factors only allow for integers to be mapped to a text label, and
these integers have to be a count starting at 1. This doesn’t work for
IPUMS data because often our variables have specific meanings for the
codes. For example, the variable <code>AGE</code> uses the value to mean
the actual age, but does have labels for age 0 and the top codes.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span>
<span class="co">#&gt; &lt;labelled&lt;integer&gt;[6]&gt;: Age</span>
<span class="co">#&gt; [1] 54 54 52 38 15 38</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:</span>
<span class="co">#&gt;  value               label</span>
<span class="co">#&gt;      0        Under 1 year</span>
<span class="co">#&gt;     90 90 (90+, 1988-2002)</span>
<span class="co">#&gt;     99                 99+</span>

<span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span><span class="op">)</span>
<span class="co">#&gt; [1] 54 54 52 38 15 38</span>
<span class="co">#&gt; 84 Levels: Under 1 year 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 ... 99+</span></code></pre></div>
<p>It may seem like the new <code>AGE_FACTOR</code> variable is okay,
but it can be very confusing!</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span>
<span class="co">#&gt; [1] 35.0226</span>

<span class="co"># mean(cps$AGE_FACTOR) # error because data is a factor not numeric</span>

<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span><span class="op">)</span><span class="op">)</span> <span class="co"># A common mistake</span>
<span class="co">#&gt; [1] 35.94836</span>

<span class="co"># The "more" correct way, but NA because of the text labels</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE_FACTOR</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in mean(as.numeric(as.character(cps$AGE_FACTOR))): NAs introduced by</span>
<span class="co">#&gt; coercion</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>Because the factor variable has to assign values starting at 1, but
the AGE variable started at 0, most values were 1 higher than they
should have been. Not all values are 1 higher though, because not all
values exist in the data, so 85, 90, and 99 are 82, 83 and 84
respectively.</p>
<p>Other variables have special meanings behind certain codes. For
example, often missing or NIU values are indicated in IPUMS by values
starting with the number 9 that are offset from the typical values. R’s
factors do not allow for this separation, so the missing codes will be
harder to distinguish.</p>
<p>Factors also require that every value be labelled, which is not
always true in IPUMS data. In the AGE variable, the only values with
labels are 0, 90 and 99. For all other values, there is not additional
label information.</p>
</div>
<div class="section level2">
<h2 id="is-the-labelled-class-a-panacea-hint-no">Is the labelled class a panacea? (Hint: no)<a class="anchor" aria-label="anchor" href="#is-the-labelled-class-a-panacea-hint-no"></a>
</h2>
<p>Though the labelled class does express all of the meaning provided by
IPUMS value labels into R, many R functions cannot use them or even
actively remove them from the data.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="co">#&gt;     val lbl      </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Excellent</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Very good</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Good     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Fair     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Poor</span>

<span class="va">HEALTH2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span> <span class="op">&gt;</span> <span class="fl">3</span>, <span class="fl">3</span>, <span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">HEALTH2</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 0 × 2</span></span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 variables: val &lt;dbl&gt;, lbl &lt;chr&gt;</span></span></code></pre></div>
<p>Therefore, your first task when importing an IPUMS data set will
usually be to convert the labelled values to other data structures. The
bad news is that there’s no good automatic way to do this; a lot depends
on how you plan to use the variables in your analysis and your
preferences.</p>
<p>The good news is that the ipumsr package provides several functions
to make this process easier.</p>
<p>I think it is easiest to learn them by seeing them in action, so see
below for a workflow for bringing in the CPS example extract. For your
reference, here is a list of the functions:</p>
<ul>
<li>
<code><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor()</a></code> (reexported from the haven package)</li>
<li>
<code><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels()</a></code> (also from haven)</li>
<li><code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code></li>
<li><code><a href="../reference/lbl_collapse.html">lbl_collapse()</a></code></li>
<li><code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code></li>
<li><code><a href="../reference/lbl_add.html">lbl_add()</a></code></li>
<li><code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code></li>
</ul>
</div>
<div class="section level2">
<h2 id="workflow-example-using-ipumsr-functions">Workflow example using ipumsr functions<a class="anchor" aria-label="anchor" href="#workflow-example-using-ipumsr-functions"></a>
</h2>
<div class="section level3">
<h3 id="as_factor">
<code>as_factor()</code><a class="anchor" aria-label="anchor" href="#as_factor"></a>
</h3>
<p>The HEALTH variable is structured just like a factor and so can be
converted directly. The <code><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor()</a></code> function is the easiest
way to do so.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="co">#&gt;     val lbl      </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 Excellent</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 Very good</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 Good     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 Fair     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 Poor</span>
<span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">HEALTH</span><span class="op">)</span></code></pre></div>
<p>The ASECFLAG and MONTH variables can also be converted directly
(these were included by default by the IPUMS extract engine, but aren’t
useful here because this data set only has respondents from ASEC in
March)</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps</span><span class="op">$</span><span class="va">ASECFLAG</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">ASECFLAG</span><span class="op">)</span>
<span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MONTH</span><span class="op">)</span></code></pre></div>
<p><code>as_factor</code> works on data.frames by converting every
labelled variable to a factor. However, this can create confusing
variables like AGE_FACTOR from above, so this isn’t the best thing to do
right away.</p>
</div>
<div class="section level3">
<h3 id="zap_labels">
<code>zap_labels()</code><a class="anchor" aria-label="anchor" href="#zap_labels"></a>
</h3>
<p>I may decide that for my analysis, the AGE variable is most useful as
the numeric values. The <code><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels()</a></code> function removes the
labels.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">AGE</span><span class="op">)</span></code></pre></div>
<p>The top-codes (which are only available on the CPS website) indicate
that the value 80 actually indicates 80-84 and 85 indicates 85+, so
another option would be to convert them to a factor with age ranges.</p>
</div>
<div class="section level3">
<h3 id="lbl_clean">
<code>lbl_clean()</code><a class="anchor" aria-label="anchor" href="#lbl_clean"></a>
</h3>
<p>This extract only contains data from a few states and I don’t want
the factor to have a level for the unused ones. The
<code><a href="../reference/lbl_clean.html">lbl_clean()</a></code> function keeps only labels for values in the
current data set and returns a labelled variable which we can convert to
a factor.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 75 × 2</span></span>
<span class="co">#&gt;      val lbl                 </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     1 Alabama             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     2 Alaska              </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     4 Arizona             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     5 Arkansas            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     6 California          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     8 Colorado            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     9 Connecticut         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    10 Delaware            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    11 District of Columbia</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    12 Florida             </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 65 more rows</span></span>
<span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_clean.html">lbl_clean</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span>

<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 2</span></span>
<span class="co">#&gt;     val lbl         </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>    19 Iowa        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    27 Minnesota   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    38 North Dakota</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    46 South Dakota</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    55 Wisconsin</span>
<span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">STATEFIP</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lbl_na_if">
<code>lbl_na_if()</code><a class="anchor" aria-label="anchor" href="#lbl_na_if"></a>
</h3>
<p>The INCTOT variable has 2 labelled values that are not actually
incomes: 99999998 indicates “Missing” and 99999999 indicate “Not in
Universe”. On the CPS website, the Universe tab indicates that the
Universe for 2016 is respondents age 15+. Let’s say for my analysis, I
can treat these values as missing.</p>
<p>The <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code> function takes the variable and a
function that refers to .val and .lbl (the values and labels
respectively) and returns an indicator of whether to set those values to
NA and remove the label. You can also use the <code>~</code> notation
from the purrr package to create succinct anonymous functions.</p>
<p>The .val and .lbl only refer to values that already have labels, they
do not apply to unlabeled values. See the <code><a href="../reference/lbl_add.html">lbl_add()</a></code> and
<code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code> functions below for working with unlabeled
values.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Caution: R defaults to printing large numbers like 99999999 in rounded </span>
<span class="co"># exponential format (1e+08) but that's not how they are actually stored</span>
<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 2</span></span>
<span class="co">#&gt;        val lbl                      </span>
<span class="co">#&gt;      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 99<span style="text-decoration: underline;">999</span>998 Missing.                 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 99<span style="text-decoration: underline;">999</span>999 N.I.U. (Not in Universe).</span>

<span class="co"># All of these are equivalent</span>
<span class="va">INCTOT1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span><span class="va">.val</span> <span class="op">&gt;=</span> <span class="fl">99999990</span><span class="op">)</span>
<span class="va">INCTOT2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span><span class="va">.lbl</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Missing."</span>, <span class="st">"N.I.U. (Not in Universe)."</span><span class="op">)</span><span class="op">)</span>
<span class="va">INCTOT3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="kw">function</span><span class="op">(</span><span class="va">.val</span>, <span class="va">.lbl</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">is_missing</span> <span class="op">&lt;-</span> <span class="va">.val</span> <span class="op">==</span> <span class="fl">99999998</span>
  <span class="va">is_niu</span> <span class="op">&lt;-</span> <span class="va">.lbl</span> <span class="op">==</span> <span class="st">"N.I.U. (Not in Universe)."</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">is_missing</span> <span class="op">|</span> <span class="va">is_niu</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="co"># Change to a factor in the original cps data.frame</span>
<span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span><span class="va">.val</span> <span class="op">&gt;=</span> <span class="fl">9999990</span><span class="op">)</span>
<span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lbl_collapse">
<code>lbl_collapse()</code><a class="anchor" aria-label="anchor" href="#lbl_collapse"></a>
</h3>
<p>The EDUC variable provides an example of a common IPUMS practice of
grouping categories together by the starting digits. For example, the
value 10 indicates “Grades 1, 2, 3, or 4”, and 11 - “Grade 1”, 12 -
“Grade 2”, etc.</p>
<p>Let’s say that I only care about those more general categories
provided by the first 2 digits. The <code><a href="../reference/lbl_collapse.html">lbl_collapse()</a></code> function
allows me to provide a function that takes .val and .lbl and returns the
value to assign it to. If that code is already used, then the all of the
values assigned to it will get that label, otherwise the label of the
smallest value is used. Just like with <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>, the
purrr-style compact syntax using <code>~</code> functions is
supported.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 36 × 2</span></span>
<span class="co">#&gt;      val lbl                 </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0 NIU or no schooling </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 NIU or blank        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 None or preschool   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>    10 Grades 1, 2, 3, or 4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>    11 Grade 1             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>    12 Grade 2             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>    13 Grade 3             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>    14 Grade 4             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>    20 Grades 5 or 6       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>    21 Grade 5             </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 26 more rows</span></span>
<span class="co"># %/% is integer division, which divides by the number but doesn't keep the remainder</span>
<span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_collapse.html">lbl_collapse</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span>, <span class="op">~</span><span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/Arithmetic.html" class="external-link">%/%</a></span> <span class="fl">10</span><span class="op">)</span>

<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 14 × 2</span></span>
<span class="co">#&gt;      val lbl                 </span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>     0 NIU or no schooling </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>     1 Grades 1, 2, 3, or 4</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>     2 Grades 5 or 6       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>     3 Grades 7 or 8       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>     4 Grade 9             </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>     5 Grade 10            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>     6 Grade 11            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>     7 Grade 12            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>     8 1 year of college   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span>     9 2 years of college  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span>    10 3 years of college  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span>    11 4 years of college  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span>    12 5+ years of college </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span>    99 Missing/Unknown</span>

<span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">EDUC</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lbl_relabel">
<code>lbl_relabel()</code><a class="anchor" aria-label="anchor" href="#lbl_relabel"></a>
</h3>
<p>Sometimes you may wish to move the labels into new categories. For
example, the categories in MIGRATE1 may not quite map what I want to use
in my analysis.</p>
<p>The <code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> function provides a more flexible way
to group existing labelled values into new ones. It takes a two-sided
formula, where the left-hand side is a label (defined with the
<code><a href="../reference/lbl.html">lbl()</a></code> function) and the right hand side is an expression
that can use .val and .lbl to evaluate to a logical indicating which
values should be assigned to this label.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span>
<span class="co">#&gt;     val lbl                                 </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                               </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 NIU                                 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Same house                          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     2 Different house, place not reported </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     3 Moved within county                 </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     4 Moved within state, different county</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     5 Moved between states                </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     6 Abroad                              </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span>     9 Unknown</span>

<span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_relabel.html">lbl_relabel</a></span><span class="op">(</span>
  <span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span>,
  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">0</span>, <span class="st">"NIU / Missing / Unknown"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">9</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">1</span>, <span class="st">"Stayed in state"</span><span class="op">)</span> <span class="op">~</span> <span class="va">.val</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/ipums_var_info.html">ipums_val_labels</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span>
<span class="co">#&gt;     val lbl                    </span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0 NIU / Missing / Unknown</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     1 Stayed in state        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     5 Moved between states   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     6 Abroad</span>

<span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://forcats.tidyverse.org/reference/as_factor.html" class="external-link">as_factor</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">MIGRATE1</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lbl_add-and-lbl_add_vals">
<code>lbl_add()</code> and <code>lbl_add_vals()</code><a class="anchor" aria-label="anchor" href="#lbl_add-and-lbl_add_vals"></a>
</h3>
<p>These functions allow you to create labels for values that aren’t
already labelled. It’s harder to come up with real world examples of
when these functions would be useful, but just in case you come across
such a situation, here’s how they work.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">labelled</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">105</span>, <span class="fl">990</span>, <span class="fl">999</span>, <span class="fl">230</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>`Unknown` <span class="op">=</span> <span class="fl">990</span>, NIU <span class="op">=</span> <span class="fl">999</span><span class="op">)</span>
<span class="op">)</span>

<span class="fu"><a href="../reference/lbl_add.html">lbl_add</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">100</span>, <span class="st">"$100"</span><span class="op">)</span>, <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">105</span>, <span class="st">"$105"</span><span class="op">)</span>, <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">200</span>, <span class="st">"$200"</span><span class="op">)</span>, <span class="fu"><a href="../reference/lbl.html">lbl</a></span><span class="op">(</span><span class="fl">230</span>, <span class="st">"$230"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;labelled&lt;double&gt;[6]&gt;</span>
<span class="co">#&gt; [1] 100 200 105 990 999 230</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:</span>
<span class="co">#&gt;  value   label</span>
<span class="co">#&gt;    100    $100</span>
<span class="co">#&gt;    105    $105</span>
<span class="co">#&gt;    200    $200</span>
<span class="co">#&gt;    230    $230</span>
<span class="co">#&gt;    990 Unknown</span>
<span class="co">#&gt;    999     NIU</span>
<span class="fu"><a href="../reference/lbl_add.html">lbl_add_vals</a></span><span class="op">(</span><span class="va">x</span>, <span class="op">~</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"$"</span>, <span class="va">.</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; &lt;labelled&lt;double&gt;[6]&gt;</span>
<span class="co">#&gt; [1] 100 200 105 990 999 230</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Labels:</span>
<span class="co">#&gt;  value   label</span>
<span class="co">#&gt;    100    $100</span>
<span class="co">#&gt;    105    $105</span>
<span class="co">#&gt;    200    $200</span>
<span class="co">#&gt;    230    $230</span>
<span class="co">#&gt;    990 Unknown</span>
<span class="co">#&gt;    999     NIU</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="ready-for-analysis">Ready for analysis<a class="anchor" aria-label="anchor" href="#ready-for-analysis"></a>
</h3>
<p>And now, after converting all those labels to factors, I’m ready for
analysis! If you think of any other helper functions that would be
useful for dealing with labels please let us know by filing an issue on
<a href="https://github.com/ipums/ipumsr/issues" class="external-link">github</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="more-detail-on-how-the-lbl_-functions-work">More detail on how the lbl_* functions work<a class="anchor" aria-label="anchor" href="#more-detail-on-how-the-lbl_-functions-work"></a>
</h2>
<p>One implementation detail that may help you understand the lbl_*
functions better is that the value labels are stored separately from the
actual data. This can be important because it allows for values to exist
in the data without labels (such as the non-special codes in the INCTOT
variable from the example above) and also for value labels to exist even
if they don’t exist in the data (like the STATEFIPS that we didn’t
include in our extract).</p>
<p>The <code>.val</code> and <code>.lbl</code> pronouns that are usable
in functions like <code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code>, <code><a href="../reference/lbl_collapse.html">lbl_collapse()</a></code>
and <code><a href="../reference/lbl_relabel.html">lbl_relabel()</a></code> only include these labelled values,
<em>not</em> all values in the dataset. Though this makes many
calculations simpler, because only the labelled values are considered,
it can be confusing when you want to work with the unlabeled values.</p>
<p>For example, considering the INCTOT variable, if there are unlabeled
values that you want to set to NA, you cannot use
<code><a href="../reference/lbl_na_if.html">lbl_na_if()</a></code> directly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Reload cps data so that INCTOT is a labelled class again</span>
<span class="va">cps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="co"># Try to set all values above 1000000 to NA</span>
<span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span>, <span class="op">~</span><span class="va">.val</span> <span class="op">&gt;</span> <span class="fl">1000000</span><span class="op">)</span>
<span class="va">test1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels</a></span><span class="op">(</span><span class="va">test1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">test1</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 1230006</span>
<span class="co"># Didn't work</span></code></pre></div>
<p>Instead you should add the value labels with
<code><a href="../reference/lbl_add.html">lbl_add_vals()</a></code> (or you could use a function that doesn’t
use the labels, such as <code><a href="https://dplyr.tidyverse.org/reference/na_if.html" class="external-link">dplyr::na_if()</a></code>)</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_add.html">lbl_add_vals</a></span><span class="op">(</span><span class="va">cps</span><span class="op">$</span><span class="va">INCTOT</span><span class="op">)</span>
<span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/lbl_na_if.html">lbl_na_if</a></span><span class="op">(</span><span class="va">test2</span>, <span class="op">~</span><span class="va">.val</span> <span class="op">&gt;</span> <span class="fl">1000000</span><span class="op">)</span>
<span class="va">test2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://haven.tidyverse.org/reference/zap_labels.html" class="external-link">zap_labels</a></span><span class="op">(</span><span class="va">test2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">test2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 990003</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="other-resources">Other resources<a class="anchor" aria-label="anchor" href="#other-resources"></a>
</h2>
<p>The haven package vignette ‘semantics’ has some more details about
the motivation and implementation of the labelled class. You can view it
by running the command:
<code><a href="https://haven.tidyverse.org/articles/semantics.html" class="external-link">vignette("semantics", package = "haven")</a></code></p>
<p>The <a href="http://larmarange.github.io/labelled/articles/intro_labelled.html" class="external-link">labelled</a>
package provides other methods for manipulating value labels. It is not
installed by ipumsr, but is available on CRAN via the following command:
<code>install.packages("labelled")</code></p>
<p>The <a href="https://juba.github.io/questionr/" class="external-link">questionr</a> package
includes great functions for exploring <code>labelled</code> variables.
In particular, the functions <code>describe</code>, <code>freq</code>
and <code>lookfor</code> all print out to console information about the
variable using the value labels. It is also not installed by ipumsr, but
can be installed from CRAN using:
<code>install.packages("questionr")</code></p>
<p>Finally, the <a href="https://cran.r-project.org/package=foreign" class="external-link">foreign</a> and <a href="https://cran.r-project.org/package=prettyR" class="external-link">prettyR</a> packages
don’t use the <code>labelled</code> class data structure from haven
(which ipumsr uses), but do have very similar concepts for attaching
value labels. Code designed for these packages could be adapted for use
with the haven labelled class without too much difficulty.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
