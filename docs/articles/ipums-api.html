<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interacting with the IPUMS microdata extract API • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Interacting with the IPUMS microdata extract API">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipums.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-geography.html">Geographic data in ipumsr</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li>
      <a href="../articles/ipums-api.html">IPUMS data extract API</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="../articles/ipums-cps.html">CPS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-nhgis.html">NHGIS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-terra.html">IPUMS Terra exercise</a>
    </li>
    <li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">More project exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interacting with the IPUMS microdata extract
API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/ipums-api.Rmd" class="external-link"><code>vignettes/ipums-api.Rmd</code></a></small>
      <div class="hidden name"><code>ipums-api.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="warning-new-features-currently-in-development">Warning: New features currently in development<a class="anchor" aria-label="anchor" href="#warning-new-features-currently-in-development"></a>
</h2>
<p>The IPUMS microdata extract API is still in beta testing, and the
interface for interacting with the API using ipumsr could still change
in response to tester feedback. If you are interested in becoming a beta
tester, email <a href="mailto:ipums+api@umn.edu" class="email">ipums+api@umn.edu</a>.</p>
<p>To install the latest version of ipumsr from CRAN, use:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"ipumsr"</span><span class="op">)</span></code></pre></div>
<p>Since we are still actively developing the functions for interacting
with the API, there may be changes in our GitHub repo that are not yet
on CRAN. To install the development version of ipumsr from GitHub,
use:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"ipums/ipumsr/ipumsexamples"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span>
  <span class="st">"ipums/ipumsr"</span>, 
  build_vignettes <span class="op">=</span> <span class="cn">TRUE</span>, 
  dependencies <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The IPUMS microdata extract API allows registered IPUMS USA and CPS
users to define extracts, submit extract requests, and download extract
files without visiting the IPUMS website. ipumsr includes functions that
help R users interact with the extract API from their R session.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.ipums.org" class="external-link">ipumsr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># not necessary to use API functions, but used in some examples</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span> <span class="co"># not necessary to use API functions, but used in some examples</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setting-up-your-api-key">Setting up your API key<a class="anchor" aria-label="anchor" href="#setting-up-your-api-key"></a>
</h2>
<p>If you don’t have an IPUMS USA or IPUMS CPS account, you’ll need to
register for access. Here’s where you can <a href="https://uma.pop.umn.edu/usa/user/new?return_url=https%3A%2F%2Fusa.ipums.org%2Fusa-action%2Fmenu" class="external-link">register
for IPUMS USA</a>, or <a href="https://uma.pop.umn.edu/cps/user/new?return_url=https%3A%2F%2Fcps.ipums.org%2Fcps-action%2Fmenu" class="external-link">register
for IPUMS CPS</a>. You’ll also need to request API beta access by
emailing <a href="mailto:ipums+api@umn.edu" class="email">ipums+api@umn.edu</a>, as mentioned above.</p>
<p>Once you’re registered, you’ll need to <a href="https://account.ipums.org/api_keys" class="external-link">create an API key</a>.</p>
<p>Once you’ve created an API key, you can choose to supply it as a
function argument whenever interacting with the API, or you can set the
value of the <code>IPUMS_API_KEY</code> environment variable to your
key. The example code in this vignette assumes you have assigned your
key to this environment variable.</p>
<p>To set the value of the <code>IPUMS_API_KEY</code> environment
variable for your current session, you can use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/set_ipums_api_key.html">set_ipums_api_key</a></span><span class="op">(</span><span class="st">"paste-your-key-here"</span><span class="op">)</span></code></pre></div>
<p>To set your API key <em>and</em> save it for use in future sessions,
use the same function, but with <code>save</code> set to
<code>TRUE</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/set_ipums_api_key.html">set_ipums_api_key</a></span><span class="op">(</span><span class="st">"paste-your-key-here"</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>This will add your API key to a file named “.Renviron” in your user
home directory, so that the value of the <code>IPUMS_API_KEY</code>
environment variable is set when R starts up.</p>
</div>
<div class="section level2">
<h2 id="defining-your-extract">Defining your extract<a class="anchor" aria-label="anchor" href="#defining-your-extract"></a>
</h2>
<p>Each IPUMS data collection with API support has its own function for
defining an extract. These functions have names of the form
<code>define_extract_&lt;collection&gt;()</code>. Thus, to define an
IPUMS USA extract, you use <code><a href="../reference/define_extract_usa.html">define_extract_usa()</a></code>, and to
define an IPUMS CPS extract, you use
<code><a href="../reference/define_extract_cps.html">define_extract_cps()</a></code>.</p>
<p>All <code>define_extract_()</code> functions return an
<code>ipums_extract</code> object which can then be submitted using the
<code><a href="../reference/submit_extract.html">submit_extract()</a></code> function.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_usa.html">define_extract_usa</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"USA extract for API vignette"</span>,
  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>,<span class="st">"us2019a"</span><span class="op">)</span>,
  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"RACE"</span>,<span class="st">"STATEFIP"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">cps_extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_cps.html">define_extract_cps</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"CPS extract for API vignette"</span>,
  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps1976_01s"</span>, <span class="st">"cps1976_02b"</span><span class="op">)</span>,
  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YEAR"</span>, <span class="st">"MISH"</span>, <span class="st">"CPSIDP"</span>, <span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"UH_SEX_B1"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<p>For more details on the <code>ipums_extract</code> class, view the
documentation page with <code>?ipums_extract-class</code>.</p>
<p>Note that samples are specified using special sample ID codes, which
can be browsed <a href="https://usa.ipums.org/usa-action/samples/sample_ids" class="external-link">here on the
IPUMS USA website</a>, or <a href="https://cps.ipums.org/cps-action/samples/sample_ids" class="external-link">here for
IPUMS CPS</a>.</p>
</div>
<div class="section level2">
<h2 id="submitting-your-extract">Submitting your extract<a class="anchor" aria-label="anchor" href="#submitting-your-extract"></a>
</h2>
<p>To submit your extract, use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">usa_extract_definition</span><span class="op">)</span></code></pre></div>
<p>However, like the <code>define_extract_()</code> functions, the
<code><a href="../reference/submit_extract.html">submit_extract()</a></code> function returns an
<code>ipums_extract</code> object, and the returned object has been
updated to include the extract number, so it can be useful to save that
return object by assigning a name to it, like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">usa_extract_definition</span><span class="op">)</span></code></pre></div>
<p>That way, you can use the <code>submitted_usa_extract</code> object
as input to check the extract’s status, as shown in the next section, or
to reference the extract number:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">number</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="checking-the-status-of-your-extract">Checking the status of your extract<a class="anchor" aria-label="anchor" href="#checking-the-status-of-your-extract"></a>
</h2>
<p>To retrieve the latest status of an extract, you can use the
<code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> function.
<code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> returns an <code>ipums_extract</code>
object with the “status” element updated to reflect the latest status of
the extract, and the “download_links” element updated to include links
to any extract files that are available for download.</p>
<p>The “status” of a submitted extract is one of “queued”, “started”,
“produced”, “canceled”, “failed”, or “completed”. Only “completed”
extracts can be downloaded, but “completed” extracts older than 72 hours
may not be available for download, since extract files are removed after
that time (see discussion of the <code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code>
function below).</p>
<p>If you assigned a name to the return value of
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>, as shown above, you could get updated
information on the extract, returned as an <code>ipums_extract</code>
object, with:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="va">submitted_usa_extract</span><span class="op">)</span></code></pre></div>
<p>To print the latest status, you can use:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">status</span></code></pre></div>
<p>If you forget to capture the return value of
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>, you can pull down an
<code>ipums_extract</code> object containing all the information on your
most recent extract for a given data collection with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_last_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/get_last_extract_info.html">get_last_extract_info()</a></code> is just a convenience wrapper
around <code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list()</a></code>, described <a href="#recent">below</a>.</p>
<p>If you don’t have an <code>ipums_extract</code> object in your
environment that describes the extract you’re interested in, and you
don’t want the most recent extract, you can also query the latest status
of an extract by supplying the name of the IPUMS data collection and
extract number of the extract, in one of two formats. Here’s how you’d
get the latest information on IPUMS CPS extract number 33:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"cps:33"</span><span class="op">)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that in the first format, there are no spaces before or after
the colon, and that in both formats, there is no need to zero-pad the
extract number – in other words, use “33”, not “00033”.</p>
<p>If you want R to periodically check the status of your extract, and
only return an updated <code>ipums_extract</code> object once the
extract is ready to download, you can use
<code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>, as shown below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_cps_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="va">cps_extract_33</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> also accepts the same
<code>"collection:number"</code> and
<code>c("collection", "number")</code> specifications shown above:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_cps_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="st">"cps:33"</span><span class="op">)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_cps_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For large extracts that take a long time to produce, or when the
IPUMS servers are busy, you may not want to use
<code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>, as it will tie up your R session until
the extract is ready to download.</p>
<p><code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> will tie up your R session until the
extract is ready to download, so it might not be the best option for
large extracts that take a long time to produce. However,
<code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> does offer a
<code>timeout_seconds</code> argument to set the maximum number of
seconds you want the function to wait. By default, that argument is set
to 10,800 seconds (3 hours).</p>
<p>An alternative way to check whether your extract is ready to download
is using the <code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> function. This function
accepts either an <code>ipums_extract</code> object or a
<code>"collection:number"</code> or
<code>c("collection", "number")</code> specification, and returns a
single <code>TRUE</code> or <code>FALSE</code> value indicating whether
the extract is ready to be downloaded.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="va">cps_extract_33</span><span class="op">)</span>
<span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="st">"cps:33"</span><span class="op">)</span>
<span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>As noted above, only extracts with status “completed” can be ready to
download, but not all “completed” extracts are ready to download,
because extract files are removed from IPUMS servers after 72 hours. The
<code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> function checks whether an extract can
currently be downloaded by looking at the “download_links” element of
the extract object returned by the API.</p>
<p>Note that the API has a limit of 60 requests with the same API key
per minute, so you wouldn’t want to write a loop that repeatedly uses
<code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> to check your extract status.</p>
</div>
<div class="section level2">
<h2 id="downloading-your-extract">Downloading your extract<a class="anchor" aria-label="anchor" href="#downloading-your-extract"></a>
</h2>
<p>Once your extract is ready to download, use the
<code><a href="../reference/download_extract.html">download_extract()</a></code> function to download the data and DDI
codebook files to your computer. The <code><a href="../reference/download_extract.html">download_extract()</a></code>
function returns the path to the DDI codebook file, which can be used to
read in the downloaded data with ipumsr functions. By default, the
function will download files into your current working directory, but
alternative locations can be specified with the
<code>download_dir</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">submitted_usa_extract</span><span class="op">)</span>

<span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="va">ddi_path</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span><span class="op">)</span></code></pre></div>
<p>Or, using a <code>"collection:number"</code> or
<code>c("collection", "number")</code> specification:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="st">"cps:33"</span><span class="op">)</span>
<span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="sharing-an-extract-definition">Sharing an extract definition<a class="anchor" aria-label="anchor" href="#sharing-an-extract-definition"></a>
</h2>
<p>One exciting feature enabled by the IPUMS microdata extract API is
the ability to share a standardized extract definition with other IPUMS
users so that they can create an identical extract for themselves.
ipumsr facilitates this by offering the functions
<code><a href="../reference/save_extract_as_json.html">save_extract_as_json()</a></code> and
<code><a href="../reference/define_extract_from_json.html">define_extract_from_json()</a></code> to write extract definitions to
and read extract definitions from a standardized JSON-formatted
file.</p>
<p>To write the definition of your CPS extract number 33 to a
JSON-formatted file that can be shared with other users, you could
use:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"cps:33"</span><span class="op">)</span>
<span class="fu"><a href="../reference/save_extract_as_json.html">save_extract_as_json</a></span><span class="op">(</span><span class="va">cps_extract_33</span>, file <span class="op">=</span> <span class="st">"cps_extract_33.json"</span><span class="op">)</span></code></pre></div>
<p>Then, you or another user could use that JSON file to create a
duplicate <code>ipums_extract</code> object with the same definition,
and submit it, using:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_of_cps_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_from_json.html">define_extract_from_json</a></span><span class="op">(</span><span class="st">"cps_extract_33.json"</span><span class="op">)</span>
<span class="va">submitted_cps_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">clone_of_cps_extract_33</span><span class="op">)</span></code></pre></div>
<p>Note that the code in the previous chunk assumes that the file is
saved in the current working directory. If it’s saved somewhere else,
replace <code>"cps_extract_33.json"</code> with the full path to the
file.</p>
</div>
<div class="section level2">
<h2 id="revising-a-previous-extract">Revising a previous extract<a class="anchor" aria-label="anchor" href="#revising-a-previous-extract"></a>
</h2>
<p>ipumsr also includes convenience functions for revising a previous
extract definition, facilitating a “revise and resubmit” workflow.
Here’s how you would pull down the definition of USA extract number 33
and add a sample and a variable to it:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">old_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>
<span class="va">new_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>
  <span class="va">old_extract</span>, 
  samples <span class="op">=</span> <span class="st">"us2020a"</span>, 
  variables <span class="op">=</span> <span class="st">"RELATE"</span>
<span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/add_to_extract.html">add_to_extract()</a></code> function returns an
<code>ipums_extract</code> object that has been modified as requested
and has been reset to an unsubmitted state, by stripping the extract
number, status, and download links from the original extract. The
revised extract can then be submitted with:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newly_submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">new_extract</span><span class="op">)</span></code></pre></div>
<p>To remove values from an extract, use
<code><a href="../reference/remove_from_extract.html">remove_from_extract()</a></code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newer_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span><span class="va">new_extract</span>, samples <span class="op">=</span> <span class="st">"us2020a"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recent">Getting info on multiple recent extracts<a class="anchor" aria-label="anchor" href="#recent"></a>
</h2>
<p>You can query the API for the details and status of recent extracts
(the ten most recent, by default) using the functions
<code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list()</a></code> and
<code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl()</a></code>. The <code>_list</code>
version of the function returns a list of <code>ipums_extract</code>
objects, whereas the <code>_tbl</code> version returns a tibble
(enhanced “data.frame”) in which each row contains information on one
extract.</p>
<p>The list representation is useful if you want to be able to operate
on elements as <code>ipums_extract</code> objects. For instance, to
retrieve your most second-most-recent extract and revise it for
resubmission, you could use:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">second_most_recent_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">revised_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>
  <span class="va">second_most_recent_extract</span>, 
  samples <span class="op">=</span> <span class="st">"us2010a"</span>
<span class="op">)</span></code></pre></div>
<p>Or to download all recent extracts that are ready to download, using
<code><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">purrr::keep()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_chr()</a></code>:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">is_extract_ready</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">download_extract</span><span class="op">)</span></code></pre></div>
<p>The tibble representation is useful if you want to use functions for
manipulating data.frames to find recent extracts matching particular
criteria.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></code></pre></div>
<p>For example, to find extracts with descriptions including the word
“occupation”, you could use:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"occupation"</span>, <span class="va">description</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Filtering on properties such as “samples” or “variables” is a little
more complex, because these are stored in list columns, but it is
possible. For example, to find extracts including the variable “AGE”,
you could use <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_lgl()</a></code> like this:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">variables</span>, <span class="op">~</span><span class="st">"AGE"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To convert between these two representations, ipumsr provides the
functions <code><a href="../reference/extract_list_to_tbl.html">extract_list_to_tbl()</a></code> and
<code><a href="../reference/extract_tbl_to_list.html">extract_tbl_to_list()</a></code>, such that the following is
<code>TRUE</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/extract_list_to_tbl.html">extract_list_to_tbl</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="putting-it-all-together-with-pipes">Putting it all together, with pipes<a class="anchor" aria-label="anchor" href="#putting-it-all-together-with-pipes"></a>
</h2>
<p>The return values of the functions to interact with the API are
configured in such a way that you can define, submit, wait for,
download, and read in your extract all in one piped expression:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/define_extract_usa.html">define_extract_usa</a></span><span class="op">(</span>
    <span class="st">"USA extract for API vignette"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>,<span class="st">"us2019a"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"RACE"</span>,<span class="st">"STATEFIP"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
