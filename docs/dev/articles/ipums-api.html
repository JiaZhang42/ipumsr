<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interacting with the IPUMS API • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Interacting with the IPUMS API">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.5.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Introduction</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipums-read.html">Read IPUMS data</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li>
      <a href="../articles/ipums-api.html">Interact with the IPUMS API</a>
    </li>
    <li class="divider">
    </li>
<li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">Project-specific exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interacting with the IPUMS API</h1>
                        <h4 data-toc-skip class="author">Institute for
Social Research and Data Innovation</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/vignettes/ipums-api.Rmd" class="external-link"><code>vignettes/ipums-api.Rmd</code></a></small>
      <div class="hidden name"><code>ipums-api.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>The IPUMS API supports two asset types:</p>
<ul>
<li><p><strong>IPUMS extract</strong> endpoints can be used to submit
extract requests for processing and download completed extract
files.</p></li>
<li><p><strong>IPUMS metadata</strong> endpoints can be used to discover
and explore available IPUMS data as well as retrieve codes, names, and
other extract parameters necessary to form extract requests.</p></li>
</ul>
<p>ipumsr provides functions that support both of these assets.</p>
<p>Use of the IPUMS API enables the adoption of a programmatic workflow
that can help users to:</p>
<ul>
<li>Precisely reproduce the specifications of previous extract
requests</li>
<li>Easily revise and resubmit previous extract requests to update
analyses with new data</li>
<li>Save extract request definitions that can be shared with others
without violating IPUMS conditions</li>
<li>Integrate the extract download process with functions to load data
into R</li>
<li>Quickly identify and explore available IPUMS data sources</li>
</ul>
<p>The basic workflow for interacting with the IPUMS API is as
follows:</p>
<ol style="list-style-type: decimal">
<li>
<a href="#define">Define</a> the parameters of an extract
request</li>
<li>
<a href="#submit">Submit</a> the extract request to the IPUMS
API</li>
<li>
<a href="#check">Check</a> extract request status</li>
<li>
<a href="#download">Download</a> a completed extract</li>
</ol>
<p>Before getting started, we’ll load the necessary packages for the
examples in this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://www.ipums.org" class="external-link">ipumsr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></code></pre></div>
<div class="section level3">
<h3 id="api-availability">API Availability<a class="anchor" aria-label="anchor" href="#api-availability"></a>
</h3>
<p>IPUMS <strong>extract</strong> support is currently available via API
for the following collections:</p>
<ul>
<li>IPUMS USA</li>
<li>IPUMS CPS</li>
<li>IPUMS NHGIS</li>
</ul>
<p>IPUMS <strong>metadata</strong> support is currently available via
API for the following collections:</p>
<ul>
<li>IPUMS NHGIS</li>
</ul>
<p>API support will continue to be added for more collections in the
future. You can check general API availability for all IPUMS collections
with <code><a href="../reference/ipums_data_collections.html">ipums_data_collections()</a></code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/ipums_data_collections.html">ipums_data_collections</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 12 × 3</span></span>
<span class="co">#&gt;    collection_name     code_for_api api_support</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> IPUMS USA           usa          beta       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> IPUMS CPS           cps          beta       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> IPUMS International ipumsi       none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> IPUMS NHGIS         nhgis        v1         </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> IPUMS AHTUS         ahtus        none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> IPUMS MTUS          mtus         none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> IPUMS ATUS          atus         none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> IPUMS DHS           dhs          none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> IPUMS Higher Ed     highered     none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> IPUMS MEPS          meps         none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> IPUMS NHIS          nhis         none       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> IPUMS PMA           pma          none</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="note-new-features-currently-in-development">Note: New features currently in development<a class="anchor" aria-label="anchor" href="#note-new-features-currently-in-development"></a>
</h3>
<p>The tools in ipumsr may not necessarily support all the functionality
currently supported by the IPUMS API. See the <a href="https://developer.ipums.org/docs/apiprogram/" class="external-link">API
documentation</a> for more information about its latest features.
Furthermore, the API tools in ipumsr are in active development, and some
functionality may not yet be stable.</p>
</div>
</div>
<div class="section level2">
<h2 id="set-up-your-api-key">Set up your API key<a class="anchor" aria-label="anchor" href="#set-up-your-api-key"></a>
</h2>
<p>To interact with the IPUMS API, you’ll need to register for access
with the IPUMS project you’ll be using. If you have not yet registered,
you can find links to register for each of the API-supported IPUMS
collections below:</p>
<ul>
<li><a href="https://uma.pop.umn.edu/usa/user/new?return_url=https%3A%2F%2Fusa.ipums.org%2Fusa-action%2Fmenu" class="external-link">IPUMS
USA</a></li>
<li><a href="https://uma.pop.umn.edu/cps/user/new?return_url=https%3A%2F%2Fcps.ipums.org%2Fcps-action%2Fmenu" class="external-link">IPUMS
CPS</a></li>
<li><a href="https://uma.pop.umn.edu/nhgis/user/new?return_url=https%3A%2F%2Fnhgis.ipums.org%2Fcps-action%2Fmenu" class="external-link">IPUMS
NHGIS</a></li>
</ul>
<p>Once you’re registered, you’ll be able to <a href="https://account.ipums.org/api_keys" class="external-link">create an API key</a>.</p>
<p>By default, ipumsr API functions assume that your key is stored in
the <code>IPUMS_API_KEY</code> environment variable. You can also
provide your key directly to these functions, but storing it in an
environment variable saves you some typing and helps prevent you from
inadvertently sharing your key with others (for instance, on
GitHub).</p>
<p>You can save your API key to the <code>IPUMS_API_KEY</code>
environment variable with <code><a href="../reference/set_ipums_api_key.html">set_ipums_api_key()</a></code>. To save your
key for use in future sessions, set <code>save = TRUE</code>. This will
add your API key to your <code>.Renviron</code> file in your user home
directory.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Save key in .Renviron for use across sessions</span>
<span class="fu"><a href="../reference/set_ipums_api_key.html">set_ipums_api_key</a></span><span class="op">(</span><span class="st">"paste-your-key-here"</span>, save <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p>The rest of this vignette assumes you have obtained an API key and
stored it in the <code>IPUMS_API_KEY</code> environment variable.</p>
</div>
<div class="section level2">
<h2 id="define">Define an extract request<a class="anchor" aria-label="anchor" href="#define"></a>
</h2>
<p>Each IPUMS collection has its own extract definition function that is
used to specify the parameters of a new extract request from scratch.
These functions take the form
<code>define_extract_&lt;collection&gt;()</code>:</p>
<ul>
<li><code><a href="../reference/define_extract_usa.html">define_extract_usa()</a></code></li>
<li><code><a href="../reference/define_extract_cps.html">define_extract_cps()</a></code></li>
<li><code><a href="../reference/define_extract_nhgis.html">define_extract_nhgis()</a></code></li>
</ul>
<p>Alternatively, use <code><a href="../reference/define_extract_from_json.html">define_extract_from_json()</a></code> to load an
extract definition from an external JSON file (see <a href="#share"><em>Share an extract definition</em></a>).</p>
<p>When you define an extract request, you can specify the data to be
included in the extract and indicate the desired format and layout.</p>
<p>For instance, the following defines an extract request for the
<code>AGE</code>, <code>SEX</code>, <code>RACE</code>, and
<code>STATEFIP</code> variables from the 2018 and 2019 American
Community Survey (ACS):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_usa.html">define_extract_usa</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"USA extract for API vignette"</span>,
  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>, <span class="st">"us2019a"</span><span class="op">)</span>,
  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"STATEFIP"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">usa_extract_definition</span>
<span class="co">#&gt; Unsubmitted IPUMS USA extract </span>
<span class="co">#&gt; Description: USA extract for API vignette</span>
<span class="co">#&gt; Samples: (2 total) us2018a, us2019a</span>
<span class="co">#&gt; Variables: (4 total) AGE, SEX, RACE, STATEFIP</span></code></pre></div>
<p>Similarly, the following would produce an NHGIS extract definition
for tables P1 and P2 from the 2010 SF1a census file at the state
level:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"NHGIS extract for API vignette"</span>,
  datasets <span class="op">=</span> <span class="st">"2010_SF1a"</span>,
  data_tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P1"</span>, <span class="st">"P2"</span><span class="op">)</span>,
  geog_levels <span class="op">=</span> <span class="st">"state"</span>
<span class="op">)</span>

<span class="va">nhgis_extract_definition</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: NHGIS extract for API vignette</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2010_SF1a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>P1, P2</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></code></pre></div>
<p>Note that in NHGIS extract definitions, certain fields, like
<code>data_tables</code> and <code>geog_levels</code>, are associated
with a particular dataset. For an extract with multiple datasets, these
subfields will be applied to all <code>datasets</code> in the extract
definition:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"NHGIS extract with multiple datasets"</span>,
  datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2016_2020_ACS5a"</span>, <span class="st">"2017_2021_ACS5a"</span><span class="op">)</span>,
  data_tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"B01001"</span>, <span class="st">"B01002"</span><span class="op">)</span>,
  geog_levels <span class="op">=</span> <span class="st">"state"</span>
<span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: NHGIS extract with multiple datasets</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2016_2020_ACS5a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001, B01002</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2017_2021_ACS5a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001, B01002</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></code></pre></div>
<p>To specify unique values for a subfield for each dataset, use a named
list instead of a vector in the subfield argument. This allows you to
explicitly indicate which dataset should be associated with which
subfield values:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># In this case, data_tables are matched to individual datasets, while</span>
<span class="co"># geog_levels are recycled to all datasets</span>
<span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"NHGIS extract with multiple datasets"</span>,
  datasets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"2016_2020_ACS5a"</span>, <span class="st">"2017_2021_ACS5a"</span><span class="op">)</span>,
  data_tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    <span class="st">"2016_2020_ACS5a"</span> <span class="op">=</span> <span class="st">"B01001"</span>,
    <span class="st">"2017_2021_ACS5a"</span> <span class="op">=</span> <span class="st">"B01002"</span>
  <span class="op">)</span>,
  geog_levels <span class="op">=</span> <span class="st">"state"</span>
<span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: NHGIS extract with multiple datasets</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2016_2020_ACS5a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01001</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2017_2021_ACS5a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>B01002</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span></code></pre></div>
<p>NHGIS time series tables also have similar behavior for
<code>geog_levels</code>. See <code><a href="../reference/define_extract_nhgis.html">?define_extract_nhgis</a></code> for
more information.</p>
<div class="section level3">
<h3 id="extract-request-objects">Extract request objects<a class="anchor" aria-label="anchor" href="#extract-request-objects"></a>
</h3>
<p><code>define_extract_</code> functions always produce an object that
inherits from the <code>ipums_extract</code> class, which can be handled
by other API functions (see <code><a href="../reference/ipums_extract-class.html">?ipums_extract</a></code>). Furthermore,
these objects will have a subclass for the particular collection with
which they are associated.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">usa_extract_definition</span><span class="op">)</span>
<span class="co">#&gt; [1] "usa_extract"   "ipums_extract"</span>

<span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">nhgis_extract_definition</span><span class="op">)</span>
<span class="co">#&gt; [1] "nhgis_extract" "ipums_extract"</span></code></pre></div>
<p>While <code>ipums_extract</code> objects for different collections
have slightly different structures, they all support the same API
workflow.</p>
<p>The specifications for a given extract request object can be accessed
using standard list-indexing syntax:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_definition</span><span class="op">$</span><span class="va">samples</span>
<span class="co">#&gt; [1] "us2018a" "us2019a"</span>

<span class="va">nhgis_extract_definition</span><span class="op">[[</span><span class="st">"data_tables"</span><span class="op">]</span><span class="op">]</span>
<span class="co">#&gt; $`2010_SF1a`</span>
<span class="co">#&gt; [1] "P1" "P2"</span></code></pre></div>
<p><code>ipums_extract</code> objects also contain information about the
extract request’s status. This extract hasn’t yet been submitted, and
therefore has no extract request number:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_definition</span><span class="op">$</span><span class="va">status</span>
<span class="co">#&gt; [1] "unsubmitted"</span>

<span class="va">usa_extract_definition</span><span class="op">$</span><span class="va">number</span>
<span class="co">#&gt; [1] NA</span></code></pre></div>
<p>An extract request will receive a number once it has been submitted
to the API for processing.</p>
</div>
<div class="section level3">
<h3 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a>
</h3>
<p>To build a valid extract request, you need to know the names and
codes used for the data sources and variables you want to include.</p>
<p>While the IPUMS metadata API is not yet available for microdata
collections, users can find sample ID codes at the following links:</p>
<ul>
<li><a href="https://usa.ipums.org/usa-action/samples/sample_ids" target="_blank" class="external-link">IPUMS USA</a></li>
<li><a href="https://cps.ipums.org/cps-action/samples/sample_ids" target="_blank" class="external-link">IPUMS CPS</a></li>
</ul>
<p>For microdata variable names, refer to the relevant collection’s
online extract builder:</p>
<ul>
<li><a href="https://usa.ipums.org/usa-action/variables/group" target="_blank" class="external-link">IPUMS USA</a></li>
<li><a href="https://cps.ipums.org/cps-action/variables/group" target="_blank" class="external-link">IPUMS CPS</a></li>
</ul>
<p>IPUMS NHGIS users can find the codes used for datasets, data tables,
time series tables, and more by using
<code><a href="../reference/get_nhgis_metadata.html">get_nhgis_metadata()</a></code>.</p>
<p>NHGIS provides summary metadata for all available data sources of a
given type (e.g. datasets, shapefiles) or detailed metadata for a
specific data source.</p>
<p>To explore summary metadata, use the <code>type</code> argument. This
produces a <code>tibble</code> of information about each available data
source and is best used to determine the name used by the API to
reference a data source of interest.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get_nhgis_metadata.html">get_nhgis_metadata</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"time_series_tables"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 6</span></span>
<span class="co">#&gt;   name  description                       geographic_int…¹ seque…² years geog_…³</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lis&gt;</span> <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> A00   Total Population                  Nominal             0.01 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> AV0   Total Population                  Nominal             0.02 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> B78   Total Population                  Nominal             0.03 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> CL8   Total Population                  Standardized to…    0.04 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> A57   Persons by Urban/Rural Status [4] Nominal             5.01 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> A59   Persons by Urban/Rural Status [4] Nominal             5.02 &lt;chr&gt; &lt;chr&gt;  </span>
<span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​geographic_integration, ²​sequence,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ³​geog_levels</span></span></code></pre></div>
<p>To get details on a particular data source, pass its name to the
associated argument of <code><a href="../reference/get_nhgis_metadata.html">get_nhgis_metadata()</a></code>. Use this to
determine the codes and descriptions of various subfields for a given
data source (e.g. data tables for a given dataset, geographic levels for
a dataset or time series table, etc.).</p>
<p>For instance, we could use this metadata to determine that the tables
included in the extract request above (P1 and P2) correspond to total
population counts and urban/rural population counts, respectively:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ds_meta</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_nhgis_metadata.html">get_nhgis_metadata</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"2010_SF1a"</span><span class="op">)</span>

<span class="va">ds_meta</span><span class="op">$</span><span class="va">data_tables</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">name</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"P1"</span>, <span class="st">"P2"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 4</span></span>
<span class="co">#&gt;   name  nhgis_code description      sequence</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P1    H7V        Total Population        1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P2    H7W        Urban and Rural         2</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="submit">Submit an extract<a class="anchor" aria-label="anchor" href="#submit"></a>
</h2>
<p>To submit an extract definition for processing, use
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>.</p>
<p>If no errors are detected in the extract definition, a submitted
extract request will be returned with its assigned number and status.
Storing the returned object can be useful for checking the extract
request’s status later.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">usa_extract_definition</span><span class="op">)</span>
<span class="co">#&gt; Successfully submitted IPUMS USA extract number 92</span>

<span class="va">submitted_nhgis_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">nhgis_extract_definition</span><span class="op">)</span>
<span class="co">#&gt; Successfully submitted IPUMS NHGIS extract number 960</span></code></pre></div>
<p>The extract number will be stored in the returned object:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">number</span>
<span class="co">#&gt; [1] 92</span>

<span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">status</span>
<span class="co">#&gt; [1] "queued"</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="check">Check the status of an extract<a class="anchor" aria-label="anchor" href="#check"></a>
</h2>
<p>It may take some time for the IPUMS servers to process your extract
request. To determine if your extract is ready to download, you can
check its latest status with <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code>, which will
return an <code>ipums_extract</code> object reflecting the requested
extract definition with the most current <code>status</code>. The
<code>status</code> of a submitted extract will be one of
<code>"queued"</code>, <code>"started"</code>, <code>"produced"</code>,
<code>"canceled"</code>, <code>"failed"</code>, or
<code>"completed"</code>.</p>
<p>If the extract is complete and ready for download, the
<code>download_links</code> field will be populated with any extract
files that are available for download.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="va">submitted_usa_extract</span><span class="op">)</span>

<span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">status</span>
<span class="co">#&gt; [1] "queued"</span>

<span class="va">submitted_usa_extract</span><span class="op">$</span><span class="va">download_links</span>
<span class="co">#&gt; named list()</span></code></pre></div>
<p>If you forget to capture the return value of
<code><a href="../reference/submit_extract.html">submit_extract()</a></code>, you can use the
<code><a href="../reference/get_extract_info.html">get_last_extract_info()</a></code> helper to request the information
for your most recent extract request for a given collection:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_usa_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></code></pre></div>
<p>You can also request the information for any single extract request
by passing the collection and extract number to
<code><a href="../reference/get_extract_info.html">get_extract_info()</a></code>. These can be provided either as a
single string of the form <code>"collection:number"</code> or as a
length-2 vector: <code>c(collection, number)</code>. Several other API
functions also support this syntax. Note that there is no need to
include the padded zeroes that are included in extract file names
(e.g. 00010).</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># These are equivalent:</span>
<span class="va">cps_extract_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"cps:10"</span><span class="op">)</span>
<span class="va">cps_extract_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cps"</span>, <span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you regularly use only a single IPUMS collection, you can save
yourself some typing by setting that collection as your default.
<code><a href="../reference/set_ipums_default_collection.html">set_ipums_default_collection()</a></code> will save a specified
collection to the value of the <code>IPUMS_DEFAULT_COLLECTION</code>
environment variable. If you have a default collection set, API
functions will use that collection in all requests, assuming no other
collection is specified.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/set_ipums_default_collection.html">set_ipums_default_collection</a></span><span class="op">(</span><span class="st">"cps"</span><span class="op">)</span> <span class="co"># Set `save = TRUE` to store across sessions</span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check the default collection:</span>
<span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"IPUMS_DEFAULT_COLLECTION"</span><span class="op">)</span>
<span class="co">#&gt; [1] "cps"</span>

<span class="co"># Most recent CPS extract:</span>
<span class="fu"><a href="../reference/get_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; Submitted IPUMS CPS extract number 15</span>
<span class="co">#&gt; Description: Compare age-sex-race breakdowns 1976</span>
<span class="co">#&gt; Samples: (2 total) cps1976_01s, cps1976_02b</span>
<span class="co">#&gt; Variables: (12 total) YEAR, SERIAL, MONTH, CPSID, MISH, PERNUM, WTFINL, CPSID...</span>

<span class="co"># Request info on extract request "cps:10"</span>
<span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt; Submitted IPUMS CPS extract number 10</span>
<span class="co">#&gt; Description: Compare age-sex-race breakdowns 1976</span>
<span class="co">#&gt; Samples: (2 total) cps1976_01s, cps1976_02b</span>
<span class="co">#&gt; Variables: (12 total) YEAR, SERIAL, MONTH, CPSID, MISH, PERNUM, WTFINL, CPSID...</span>

<span class="co"># You can still request other collections as usual:</span>
<span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:10"</span><span class="op">)</span>
<span class="co">#&gt; Submitted IPUMS USA extract number 10</span>
<span class="co">#&gt; Description: testing</span>
<span class="co">#&gt; Samples: (1 total) us2019a</span>
<span class="co">#&gt; Variables: (14 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER, STATEFIP...</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download">Download an extract<a class="anchor" aria-label="anchor" href="#download"></a>
</h2>
<p>To be available for download, an extract must have a
<code>"completed"</code> status. However, some requests that are
<code>"completed"</code> may still be unavailable for download, as
extracts expire and are removed from IPUMS servers after a set period of
time (72 hours for microdata collections, 2 weeks for IPUMS NHGIS).</p>
<p>You can check whether an extract is ready for download with
<code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code>:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="va">submitted_usa_extract</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>This function will also warn you if your extract has expired and
needs to be resubmitted.</p>
<p>If your extract is ready to download, you can use
<code><a href="../reference/download_extract.html">download_extract()</a></code> to download the extract’s data files to
your local machine.</p>
<p>This will return the path to the downloaded file(s) required to load
the data into R. For microdata collections, this is the path to the DDI
codebook (.xml) file, which can be used to read the associated data
(contained in a .dat.gz file).</p>
<p>For NHGIS, this will be a path to the .zip archive containing the
requested data files or shapefiles. If both data and shapefiles are
requested, <code><a href="../reference/download_extract.html">download_extract()</a></code> will return a length-2 vector
of paths to each, with data files first.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># By default, downloads to your current working directory</span>
<span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">submitted_usa_extract</span><span class="op">)</span></code></pre></div>
<p>The files produced by download_extract can be passed directly into
the reader functions provided by ipumsr.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="va">ddi_path</span><span class="op">)</span>
<span class="va">micro_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span><span class="op">)</span></code></pre></div>
<p>If your extract request has not finished processing, you’ll receive
an error when attempting to download. If you want to ensure that you
wait until the extract is ready before attempting to download, set
<code>wait = TRUE</code>. If the extract request is not yet ready, R
will poll the API regularly (each interval will increase by 10 seconds)
until processing has completed. (To wait for extract completion
<em>without</em> downloading, use <code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>.)</p>
<p>Note that setting <code>wait = TRUE</code> will tie up your R session
until the extract is ready to download. This may be undesirable behavior
for large extracts that take a long time to produce or when the IPUMS
servers are busy. You can set a maximum wait time and adjust other API
polling parameters in <code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> and
<code><a href="../reference/download_extract.html">download_extract()</a></code>. See <code><a href="../reference/wait_for_extract.html">?wait_for_extract</a></code> for
details.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">submitted_nhgis_extract</span>, wait <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_nhgis.html">read_nhgis</a></span><span class="op">(</span><span class="va">nhgis_path</span><span class="op">)</span>
<span class="co">#&gt; Use of data from NHGIS is subject to conditions including that users should cite the data appropriately. Use command `ipums_conditions()` for more details.</span>
<span class="co">#&gt; <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">52</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">64</span></span>
<span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span>
<span class="co">#&gt; <span style="font-weight: bold;">Delimiter:</span> ","</span>
<span class="co">#&gt; <span style="color: #BB0000;">chr</span>  (7): GISJOIN, STUSAB, STATE, STATEA, NAME, FUNCSTAT, LSADC</span>
<span class="co">#&gt; <span style="color: #00BB00;">dbl</span> (14): YEAR, REGIONA, DIVISIONA, AREALAND, AREAWATR, INTPTLAT, INTPTLON, ...</span>
<span class="co">#&gt; <span style="color: #BBBB00;">lgl</span> (43): COUNTYA, COUSUBA, COUSUBCC, PLACEA, PLACECC, TRACTA, BLKGRPA, BLOC...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nhgis_data</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 64</span></span>
<span class="co">#&gt;   GISJOIN  YEAR STUSAB REGIONA DIVISIONA STATE    STATEA COUNTYA COUSUBA COUSU…¹</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> G010     <span style="text-decoration: underline;">2</span>010 AL           3         6 Alabama  01     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> G020     <span style="text-decoration: underline;">2</span>010 AK           4         9 Alaska   02     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> G040     <span style="text-decoration: underline;">2</span>010 AZ           4         8 Arizona  04     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> G050     <span style="text-decoration: underline;">2</span>010 AR           3         7 Arkansas 05     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> G060     <span style="text-decoration: underline;">2</span>010 CA           4         9 Califor… 06     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> G080     <span style="text-decoration: underline;">2</span>010 CO           4         8 Colorado 08     <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span>     </span>
<span class="co">#&gt; <span style="color: #949494;"># … with 54 more variables: PLACEA &lt;lgl&gt;, PLACECC &lt;lgl&gt;, TRACTA &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   BLKGRPA &lt;lgl&gt;, BLOCKA &lt;lgl&gt;, CONCITA &lt;lgl&gt;, AIANHHA &lt;lgl&gt;, RES_ONLYA &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   TRUSTA &lt;lgl&gt;, AIANHHCC &lt;lgl&gt;, AITSCEA &lt;lgl&gt;, AITS &lt;lgl&gt;, TTRACTA &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   TBLKGRPA &lt;lgl&gt;, ANRCA &lt;lgl&gt;, CBSAA &lt;lgl&gt;, METDIVA &lt;lgl&gt;, CSAA &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   NECTAA &lt;lgl&gt;, NECTADIVA &lt;lgl&gt;, CNECTAA &lt;lgl&gt;, CBSAPCI &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   NECTAPCI &lt;lgl&gt;, UAA &lt;lgl&gt;, UATYPE &lt;lgl&gt;, URA &lt;lgl&gt;, CDA &lt;lgl&gt;, SLDUA &lt;lgl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   SLDLA &lt;lgl&gt;, VTD &lt;lgl&gt;, VTDI &lt;lgl&gt;, ZCTA5A &lt;lgl&gt;, SUBMCDA &lt;lgl&gt;, …</span></span></code></pre></div>
<p>See the collection-specific vignettes for more information about
loading IPUMS data into R.</p>
</div>
<div class="section level2">
<h2 id="share">Share an extract definition<a class="anchor" aria-label="anchor" href="#share"></a>
</h2>
<p>One exciting feature enabled by the IPUMS API is the ability to share
a standardized extract definition with other IPUMS users so that they
can create an identical extract request themselves. The terms of use for
most IPUMS collections prohibit the redistribution of IPUMS data, but
don’t prohibit sharing data extract definitions.</p>
<p>ipumsr facilitates this type of sharing with
<code><a href="../reference/define_extract_from_json.html">save_extract_as_json()</a></code> and
<code><a href="../reference/define_extract_from_json.html">define_extract_from_json()</a></code>, which read and write
<code>ipums_extract</code> objects to and from a standardized
JSON-formatted file.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cps_extract_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"cps:10"</span><span class="op">)</span>
<span class="fu"><a href="../reference/define_extract_from_json.html">save_extract_as_json</a></span><span class="op">(</span><span class="va">cps_extract_10</span>, file <span class="op">=</span> <span class="st">"cps_extract_10.json"</span><span class="op">)</span></code></pre></div>
<p>At this point, you can send <code>cps_extract_10.json</code> to
another user to allow them to create a duplicate
<code>ipums_extract</code> object, which they can load and submit to the
API themselves.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_of_cps_extract_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_from_json.html">define_extract_from_json</a></span><span class="op">(</span><span class="st">"cps_extract_10.json"</span><span class="op">)</span>
<span class="va">submitted_cps_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">clone_of_cps_extract_10</span><span class="op">)</span></code></pre></div>
<p>(Note that the code in the previous chunk assumes that the file is
saved in the current working directory. If it’s saved somewhere else,
replace <code>"cps_extract_10.json"</code> with the full path to the
file.)</p>
</div>
<div class="section level2">
<h2 id="revise-a-previous-extract">Revise a previous extract<a class="anchor" aria-label="anchor" href="#revise-a-previous-extract"></a>
</h2>
<p>It’s not uncommon to find that you no longer need certain data or
would like to update a familiar extract definition with different or
more current data. ipumsr includes functions for revising a previous
extract definition, facilitating a “revise and resubmit” workflow.</p>
<p>Let’s say you decided you wanted to include the 2020 ACS sample as
well as the <code>RELATE</code> variable to the data from a previous
IPUMS USA extract. You can retrieve that extract definition as described
above and add new values with <code><a href="../reference/add_to_extract.html">add_to_extract()</a></code>. In general,
any parameters that can be passed to a collection’s
<code>define_extract_</code> function can also be provided to
<code><a href="../reference/add_to_extract.html">add_to_extract()</a></code>.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">old_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>

<span class="va">old_extract</span><span class="op">$</span><span class="va">samples</span>
<span class="co">#&gt; [1] "us2017b"</span>

<span class="va">old_extract</span><span class="op">$</span><span class="va">variables</span>
<span class="co">#&gt; [1] "YEAR"     "SAMPLE"   "SERIAL"   "CBSERIAL" "HHWT"     "GQ"       "PERNUM"  </span>
<span class="co">#&gt; [8] "PERWT"</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>
  <span class="va">old_extract</span>,
  samples <span class="op">=</span> <span class="st">"us2020a"</span>,
  variables <span class="op">=</span> <span class="st">"RELATE"</span>,
  data_format <span class="op">=</span> <span class="st">"sas9"</span>
<span class="op">)</span>

<span class="va">new_extract</span><span class="op">$</span><span class="va">samples</span>
<span class="co">#&gt; [1] "us2017b" "us2020a"</span>

<span class="va">new_extract</span><span class="op">$</span><span class="va">variables</span>
<span class="co">#&gt; [1] "YEAR"     "SAMPLE"   "SERIAL"   "CBSERIAL" "HHWT"     "GQ"       "PERNUM"  </span>
<span class="co">#&gt; [8] "PERWT"    "RELATE"</span></code></pre></div>
<p>The new extract contains the contents of the original extract
definition for USA 33 along with the new sample, variable, and format
selections. For fields that take a single value, like
<code>data_format</code>, the new value will automatically replace the
existing one:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_extract</span><span class="op">$</span><span class="va">data_format</span>
<span class="co">#&gt; [1] "sas9"</span></code></pre></div>
<p>Note that because the returned <code>ipums_extract</code> object
represents a new extract definition, it will have been reset to an
unsubmitted status and its extract number and download links will have
been removed.</p>
<p>To submit this updated extract definition, just use
<code><a href="../reference/submit_extract.html">submit_extract()</a></code> again:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">updated_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">new_extract</span><span class="op">)</span></code></pre></div>
<p>On the other hand, if there are values that you no longer want to
include in your extract request, use
<code><a href="../reference/remove_from_extract.html">remove_from_extract()</a></code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">new_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span><span class="va">new_extract</span>, samples <span class="op">=</span> <span class="st">"us2020a"</span><span class="op">)</span>

<span class="va">new_extract</span><span class="op">$</span><span class="va">samples</span>
<span class="co">#&gt; [1] "us2017b"</span></code></pre></div>
<p>For NHGIS extracts, removing a dataset or time series table will
remove all its associated subfields:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_nhgis.html">define_extract_nhgis</a></span><span class="op">(</span>
  description <span class="op">=</span> <span class="st">"Extract request with multiple TSTs"</span>,
  time_series_tables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"A00"</span>, <span class="st">"AV0"</span><span class="op">)</span>,
  geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span>, <span class="st">"state"</span><span class="op">)</span>
<span class="op">)</span>

<span class="va">nhgis_extract_definition</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: Extract request with multiple TSTs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>A00</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>AV0</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state</span>

<span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span><span class="va">nhgis_extract_definition</span>, time_series_tables <span class="op">=</span> <span class="st">"A00"</span><span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: Extract request with multiple TSTs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>AV0</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state</span></code></pre></div>
<p>In contrast, removing a subfield value will remove it from all
datasets or time series tables in the extract:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span><span class="va">nhgis_extract_definition</span>, geog_levels <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: Extract request with multiple TSTs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>A00</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>AV0</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county</span></code></pre></div>
<p>To selectively modify subfields from particular datasets or time
series tables, pass a list to the argument instead of a vector. This
allows you to indicate which parent field should have the subfield
modified. This is analogous to the syntax that can be used when defining
an NHGIS extract request.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_extract_definition</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>AV0 <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>A00 <span class="op">=</span> <span class="st">"state"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: Extract request with multiple TSTs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>A00</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>AV0</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>county, state, nation</span></code></pre></div>
<p>Note that it is possible to produce invalid extract definitions when
revising an extract. If you want to <em>replace</em> values in a
definition, it is usually best to use <code><a href="../reference/add_to_extract.html">add_to_extract()</a></code>
before <code><a href="../reference/remove_from_extract.html">remove_from_extract()</a></code> to limit the possibility of
removing required extract fields.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Throws error because all time series tables must have geog levels:</span>
<span class="va">nhgis_extract_definition</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #BBBB00; font-weight: bold;">Error</span><span style="font-weight: bold;"> in `validate_ipums_extract()`:</span></span>
<span class="co">#&gt; <span style="color: #BBBB00;">!</span> Invalid `nhgis_extract` object:</span>
<span class="co">#&gt; <span style="color: #BB0000;">✖</span> `geog_levels` must not contain missing values for any of the provided `datasets` or `time_series_tables`.</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Add new values to extract definition first to avoid the error:</span>
<span class="va">nhgis_extract_definition</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="st">"nation"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/remove_from_extract.html">remove_from_extract</a></span><span class="op">(</span>geog_levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"county"</span>, <span class="st">"state"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Unsubmitted IPUMS NHGIS extract </span>
<span class="co">#&gt; Description: Extract request with multiple TSTs</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>A00</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>nation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BB00; font-weight: bold;">Time Series Table: </span>AV0</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>nation</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="recent">Get info on past extracts<a class="anchor" aria-label="anchor" href="#recent"></a>
</h2>
<p>If you know you made a specific extract definition in the past, but
you can’t remember the exact number, you can use
<code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> to peruse your recent extract requests.
Just provide a collection to the <code>extract</code> argument instead
of a collection with an extract number.</p>
<p>By default, this returns your 10 most recent extract requests as a
list of <code>ipums_extract</code> objects. You can adjust how many
requests to retrieve with the <code>how_many</code> argument:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nhgis_extracts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"nhgis"</span>, how_many <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>

<span class="va">nhgis_extracts</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; Submitted IPUMS NHGIS extract number 960</span>
<span class="co">#&gt; Description: NHGIS extract for API vignette</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2010_SF1a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>P1, P2</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Breakdowns: </span>bs32.ge00</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; Submitted IPUMS NHGIS extract number 959</span>
<span class="co">#&gt; Description: NHGIS extract for API vignette</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2010_SF1a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>P1, P2</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Breakdowns: </span>bs32.ge00</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; Submitted IPUMS NHGIS extract number 958</span>
<span class="co">#&gt; Description: NHGIS extract for API vignette</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #0000BB; font-weight: bold;">Dataset: </span>2010_SF1a</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Tables: </span>P1, P2</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Geog Levels: </span>state</span>
<span class="co">#&gt;   <span style="font-weight: bold;">Breakdowns: </span>bs32.ge00</span></code></pre></div>
<p>Because this is a list of <code>ipums_extract</code> objects, you can
operate on them with the familiar API functions. For instance, to revise
your second-most-recent extract for resubmission:</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">revised_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_to_extract.html">add_to_extract</a></span><span class="op">(</span>
  <span class="va">nhgis_extracts</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>,
  shapefiles <span class="op">=</span> <span class="st">"us_nation_2010_tl2010"</span>
<span class="op">)</span></code></pre></div>
<p>You could even download all recent extracts that have completed,
using <code><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">purrr::keep()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map()</a></code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_paths</span> <span class="op">&lt;-</span> <span class="va">nhgis_extracts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html" class="external-link">keep</a></span><span class="op">(</span><span class="va">is_extract_ready</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">download_extract</span><span class="op">)</span></code></pre></div>
<p>Set <code>table = TRUE</code> to get the same information in a
tabular format:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span>, how_many <span class="op">=</span> <span class="fl">5</span>, table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">usa_extract_tbl</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 5 × 11</span></span>
<span class="co">#&gt;   collect…¹ descr…² data_…³ recta…⁴ data_…⁵ samples varia…⁶ submi…⁷ download_l…⁸</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> usa       Extrac… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> usa       My fav… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> usa       USA ex… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> usa       USA ex… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> usa       USA ex… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: number &lt;int&gt;, status &lt;chr&gt;, and abbreviated variable</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   names ¹​collection, ²​description, ³​data_structure, ⁴​rectangular_on,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ⁵​data_format, ⁶​variables, ⁷​submitted, ⁸​download_links</span></span></code></pre></div>
<p>This can be useful if you want to filter through your previous
extracts to find one with particular details.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Look for a description containing specific term</span>
<span class="va">usa_extract_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"marital status"</span>, <span class="va">description</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 11</span></span>
<span class="co">#&gt;   collect…¹ descr…² data_…³ recta…⁴ data_…⁵ samples varia…⁶ submi…⁷ download_l…⁸</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> usa       Extrac… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: number &lt;int&gt;, status &lt;chr&gt;, and abbreviated variable</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   names ¹​collection, ²​description, ³​data_structure, ⁴​rectangular_on,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ⁵​data_format, ⁶​variables, ⁷​submitted, ⁸​download_links</span></span></code></pre></div>
<p>Filtering on properties such as “samples” or “variables” is a little
more complex, because these are stored in list columns, but it is
possible (and made easier with <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">purrr::map_lgl()</a></code>).</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Find extracts including a certain variable and convert to extract object</span>
<span class="va">usa_extract_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">variables</span>, <span class="op">~</span> <span class="st">"MARST"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 1 × 11</span></span>
<span class="co">#&gt;   collect…¹ descr…² data_…³ recta…⁴ data_…⁵ samples varia…⁶ submi…⁷ download_l…⁸</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;list&gt;</span>      </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> usa       Extrac… rectan… P       fixed_… &lt;chr&gt;   &lt;chr&gt;   TRUE    &lt;named list&gt;</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: number &lt;int&gt;, status &lt;chr&gt;, and abbreviated variable</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   names ¹​collection, ²​description, ³​data_structure, ⁴​rectangular_on,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   ⁵​data_format, ⁶​variables, ⁷​submitted, ⁸​download_links</span></span></code></pre></div>
<p>To convert between these two representations, ipumsr provides the
functions <code><a href="../reference/extract_tbl_to_list.html">extract_list_to_tbl()</a></code> and
<code><a href="../reference/extract_tbl_to_list.html">extract_tbl_to_list()</a></code>, such that the following holds:</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html" class="external-link">identical</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/extract_tbl_to_list.html">extract_list_to_tbl</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span>, table <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>This allows you to easily find old extract definitions and convert
back to <code>ipums_extract</code> objects for resubmission.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_lgl</a></span><span class="op">(</span><span class="va">variables</span>, <span class="op">~</span> <span class="st">"MARST"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/extract_tbl_to_list.html">extract_tbl_to_list</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html" class="external-link">pluck</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; Submitted IPUMS USA extract number 94</span>
<span class="co">#&gt; Description: Extract with marital status</span>
<span class="co">#&gt; Samples: (1 total) us2019a</span>
<span class="co">#&gt; Variables: (15 total) YEAR, SAMPLE, SERIAL, CBSERIAL, HHWT, CLUSTER, STATEFIP...</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>Because each of the API functions in the standard workflow returns an
<code>ipums_extract</code> object, we can easily pipe them together in
one expression:</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_usa.html">define_extract_usa</a></span><span class="op">(</span>
  <span class="st">"USA extract for API vignette"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>, <span class="st">"us2019a"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"AGE"</span>, <span class="st">"SEX"</span>, <span class="st">"RACE"</span>, <span class="st">"STATEFIP"</span><span class="op">)</span>
<span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span>wait <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>Not only does this pipeline allow you to obtain IPUMS data without
ever leaving your R environment, but it also allows you to retain a
reproducible record of your process. This makes it much easier to
document your workflow, collaborate with other researchers, and update
your analysis in the future.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
