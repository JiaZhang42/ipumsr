<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interacting with the IPUMS USA microdata extract API • ipumsr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="../docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Interacting with the IPUMS USA microdata extract API">
<meta property="og:description" content="ipumsr">
<meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.5.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ipums.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-geography.html">Geographic data in ipumsr</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li>
      <a href="../articles/ipums-api.html">IPUMS data extract API</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/ipums-cps.html">CPS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-nhgis.html">NHGIS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-terra.html">IPUMS Terra exercise</a>
    </li>
    <li>
      <a href="https://ipums.org/exercises.shtml">More project exercises</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mnpopcenter/ipumsr">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ipums-api_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Interacting with the IPUMS USA microdata extract API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mnpopcenter/ipumsr/blob/master/vignettes/ipums-api.Rmd"><code>vignettes/ipums-api.Rmd</code></a></small>
      <div class="hidden name"><code>ipums-api.Rmd</code></div>

    </div>

    
    
<div id="warning-new-features-currently-in-development" class="section level1">
<h1 class="hasAnchor">
<a href="#warning-new-features-currently-in-development" class="anchor"></a>Warning: New features currently in development</h1>
<p>The IPUMS USA microdata extract API is still in testing and is not publicly available. A call for beta testers will go out to all IPUMS USA users in late 2021 or early 2022. Moreover, the ipumsr functions for interacting with the API are only included in the development version of the package on GitHub, not in the version on CRAN. If you are a beta tester, you can download the development version of ipumsr, which includes API functions, using:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org">remotes</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span>
<span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"mnpopcenter/ipumsr"</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="overview" class="section level1">
<h1 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h1>
<p>The IPUMS USA microdata extract API allows registered IPUMS USA users to define extracts, submit extract requests, and download extract files without visiting the IPUMS website. ipumsr includes functions that help R users<br>
interact with the extract API from their R session.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.ipums.org">ipumsr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># not necessary to use API functions, but used in some examples</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org">purrr</a></span><span class="op">)</span> <span class="co"># not necessary to use API functions, but used in some examples</span></code></pre></div>
</div>
<div id="setting-up-your-api-key" class="section level1">
<h1 class="hasAnchor">
<a href="#setting-up-your-api-key" class="anchor"></a>Setting up your API key</h1>
<p>If you don’t have an IPUMS USA account, <a href="https://uma.pop.umn.edu/usa/user/new?return_url=https%3A%2F%2Fusa.ipums.org%2Fusa-action%2Fmenuor">register for access</a>.</p>
<p>Once you’re registered, you’ll need to <a href="https://account.ipums.org/api_keys">create an API key</a>.</p>
<p>Once you’ve created an API key, you can choose to supply it as a function argument whenever interacting with the API, or you can set the value of the <code>IPUMS_API_KEY</code> environment variable to your key.</p>
<p>To set the value of the <code>IPUMS_API_KEY</code> environment variable, you can use:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html">Sys.setenv</a></span><span class="op">(</span>IPUMS_API_KEY <span class="op">=</span> <span class="st">"paste-your-key-here"</span><span class="op">)</span></code></pre></div>
<p>Or, if you want R to automatically set the value of that environment variable at the beginning of each session, add code like the following to a file named “.Renviron” in your project directory or user home directory:</p>
<pre><code>IPUMS_API_KEY = "paste-your-key-here"</code></pre>
<p>If you use the “.Renviron” approach with a project that uses Git for version control, be sure to add the “.Renviron” file to “.gitignore” so that your API key is not shared when someone clones your repository.</p>
</div>
<div id="defining-your-extract" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-your-extract" class="anchor"></a>Defining your extract</h1>
<p>The <code><a href="../reference/define_extract.html">define_extract()</a></code> function returns an object of class “ipums_extract” which can then be submitted using the <code><a href="../reference/submit_extract.html">submit_extract()</a></code> function.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract.html">define_extract</a></span><span class="op">(</span>
  collection <span class="op">=</span> <span class="st">"usa"</span>,
  description <span class="op">=</span> <span class="st">"Extract for API vignette"</span>,
  samples <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>,<span class="st">"us2019a"</span><span class="op">)</span>,
  variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"RACE"</span>,<span class="st">"STATEFIP"</span><span class="op">)</span>,
  data_format <span class="op">=</span> <span class="st">"fixed_width"</span>,
  data_structure <span class="op">=</span> <span class="st">"rectangular"</span>,
  rectangular_on <span class="op">=</span> <span class="st">"P"</span>
<span class="op">)</span></code></pre></div>
<p>Note that samples are specified using special sample ID codes, which can be browsed <a href="https://usa.ipums.org/usa-action/samples/sample_ids">here on the IPUMS USA website</a>.</p>
<p>The <code>data_format</code>, <code>data_structure</code>, and <code>rectangular_on</code> arguments have default values which match the values specified in the example above, and you can omit the argument names as long as you maintain the proper order, so you could define the same extract with:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">extract_definition</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract.html">define_extract</a></span><span class="op">(</span>
  <span class="st">"usa"</span>,
  <span class="st">"Extract for API vignette"</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>,<span class="st">"us2019a"</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"RACE"</span>,<span class="st">"STATEFIP"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="submitting-your-extract" class="section level1">
<h1 class="hasAnchor">
<a href="#submitting-your-extract" class="anchor"></a>Submitting your extract</h1>
<p>To submit your extract, use:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">extract_definition</span><span class="op">)</span></code></pre></div>
<p>However, like the <code><a href="../reference/define_extract.html">define_extract()</a></code> function, the <code><a href="../reference/submit_extract.html">submit_extract()</a></code> function returns an “ipums_extract” object, and the returned object has been updated to include the extract number, so it can be useful to save that return object by assigning a name to it, like this:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">extract_definition</span><span class="op">)</span></code></pre></div>
<p>That way, you can use the <code>submitted_extract</code> object as input to check the extract’s status, as shown in the next section, or to reference the extract number:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span><span class="op">$</span><span class="va">number</span></code></pre></div>
</div>
<div id="checking-the-status-of-your-extract" class="section level1">
<h1 class="hasAnchor">
<a href="#checking-the-status-of-your-extract" class="anchor"></a>Checking the status of your extract</h1>
<p>To retrieve the latest status of an extract, you can use the <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> function. <code><a href="../reference/get_extract_info.html">get_extract_info()</a></code> returns an “ipums_extract” object with the “status” element updated to reflect the latest status of the extract, and the “download_links” element updated to include links to any extract files that are available for download.</p>
<p>The “status” of a submitted extract is one of “queued”, “started”, “produced”, “canceled”, “failed”, or “completed”. Only “completed” extracts can be downloaded, but “completed” extracts older than 72 hours may not be available for download, since extract files are removed after that time (see discussion of the <code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> function below).</p>
<p>If you assigned a name to the return value of <code><a href="../reference/submit_extract.html">submit_extract()</a></code>, as shown above, you could get updated information on the extract, returned as an “ipums_extract” object, with:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="va">submitted_extract</span><span class="op">)</span></code></pre></div>
<p>To print the latest status, you can use:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span><span class="op">$</span><span class="va">status</span></code></pre></div>
<p>If you forget to capture the return value of <code><a href="../reference/submit_extract.html">submit_extract()</a></code>, you can get all information on your most recent extract (including the extract number) with:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_last_extract_info.html">get_last_extract_info</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/get_last_extract_info.html">get_last_extract_info()</a></code> is just a convenience wrapper around <code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list()</a></code>, described <a href="#recent">below</a>.</p>
<p>If you don’t have an “ipums_extract” object in your environment that describes the extract you’re interested in, and you don’t want the most recent extract, you can also query the latest status of an extract by supplying the name of the IPUMS data collection and extract number of the extract, in one of two formats. Here’s how you’d get the latest information on IPUMS USA extract number 33:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that in the first format, there are no spaces before or after the colon, and that in both formats, there is no need to zero-pad the extract number – in other words, use “33”, not “00033”.</p>
<p>If you want R to periodically check the status of your extract, and only return an updated “ipums_extract” object once the extract is ready to download, you can use <code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>, as shown below:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="va">submitted_extract</span><span class="op">)</span></code></pre></div>
<p><code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code> also accepts the same <code>"collection:number"</code> and <code>c("collection", "number")</code> specifications shown above:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">downloadable_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For large extracts that take a long time to produce, or when the IPUMS servers are busy, you may not want to use <code><a href="../reference/wait_for_extract.html">wait_for_extract()</a></code>, as it will tie up your R session until the extract is ready to download. Alternatively, you can use the <code>timeout_seconds</code> argument to set the maximum number of seconds you want the function to wait. By default, that argument is set to 10,800 seconds (3 hours).</p>
<p>One additional way to check whether your extract is ready to download is using the <code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> function. This function accepts either an “ipums_extract” object or a <code>"collection:number"</code> or <code>c("collection", "number")</code> specification, and returns a single <code>TRUE</code> or <code>FALSE</code> value indicating whether the extract is ready to be downloaded.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="va">submitted_extract</span><span class="op">)</span>
<span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>
<span class="fu"><a href="../reference/is_extract_ready.html">is_extract_ready</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Note that the API has a limit of 60 requests with the same API key per minute, so you wouldn’t want to write a loop that repeatedly uses <code><a href="../reference/is_extract_ready.html">is_extract_ready()</a></code> to check your extract status.</p>
</div>
<div id="downloading-your-extract" class="section level1">
<h1 class="hasAnchor">
<a href="#downloading-your-extract" class="anchor"></a>Downloading your extract</h1>
<p>Once your extract is ready to download, use the <code><a href="../reference/download_extract.html">download_extract()</a></code> function to download the data and DDI codebook files to your computer. The <code><a href="../reference/download_extract.html">download_extract()</a></code> function returns the path to the DDI codebook file, which can be used to read in the downloaded data with ipumsr functions. By default, the function will download files into your current working directory, but alternative locations can be specified with the <code>download_dir</code> argument.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="va">submitted_extract</span><span class="op">)</span>

<span class="co"># Assuming you chose either "fixed-width" or "csv" for your extract's "data_format"</span>
<span class="va">ddi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_ddi.html">read_ipums_ddi</a></span><span class="op">(</span><span class="va">ddi_path</span><span class="op">)</span>
<span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="va">ddi</span><span class="op">)</span></code></pre></div>
<p>Or, using a <code>"collection:number"</code> or <code>c("collection", "number")</code> specification:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>
<span class="va">ddi_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"usa"</span>, <span class="st">"33"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="sharing-an-extract-definition" class="section level1">
<h1 class="hasAnchor">
<a href="#sharing-an-extract-definition" class="anchor"></a>Sharing an extract definition</h1>
<p>One exciting feature enabled by the IPUMS USA data extract API is the ability to share a standardized extract definition with other IPUMS users so that they can create an identical extract for themselves. ipumsr facilitates this by offering the functions <code><a href="../reference/save_extract_as_json.html">save_extract_as_json()</a></code> and <code><a href="../reference/define_extract_from_json.html">define_extract_from_json()</a></code> to write extract definitions to and read extract definitions from a standardized JSON-formatted file.</p>
<p>To write the definition of your USA extract number 33 to a JSON-formatted file that can be shared with other users, you could use:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usa_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>
<span class="fu"><a href="../reference/save_extract_as_json.html">save_extract_as_json</a></span><span class="op">(</span><span class="va">usa_extract_33</span>, file <span class="op">=</span> <span class="st">"usa_extract_33.json"</span><span class="op">)</span></code></pre></div>
<p>Then, you or another user could use that JSON file to create a duplicate “ipums_extract” object with the same definition, and submit it, using:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">clone_of_usa_extract_33</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_extract_from_json.html">define_extract_from_json</a></span><span class="op">(</span><span class="st">"usa_extract_33.json"</span>, <span class="st">"usa"</span><span class="op">)</span>
<span class="va">submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">clone_of_usa_extract_33</span><span class="op">)</span></code></pre></div>
<p>Note that the code in the previous chunk assumes that the file is saved in the current working directory. If it’s saved somewhere else, replace <code>"usa_extract_33.json"</code> with the full path to the file.</p>
</div>
<div id="revising-a-previous-extract" class="section level1">
<h1 class="hasAnchor">
<a href="#revising-a-previous-extract" class="anchor"></a>Revising a previous extract</h1>
<p>ipumsr also includes a convenience function for revising a previous extract definition, facilitating a “revise and resubmit” workflow. Here’s how you would pull down the definition of USA extract number 33 and add a sample and a variable to it:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">old_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_extract_info.html">get_extract_info</a></span><span class="op">(</span><span class="st">"usa:33"</span><span class="op">)</span>
<span class="va">new_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/revise_extract.html">revise_extract</a></span><span class="op">(</span>
  <span class="va">old_extract</span>,
  samples_to_add <span class="op">=</span> <span class="st">"us2018a"</span>,
  vars_to_add <span class="op">=</span> <span class="st">"RELATE"</span>
<span class="op">)</span></code></pre></div>
<p>The <code><a href="../reference/revise_extract.html">revise_extract()</a></code> function returns an “ipums_extract” object that has been modified as requested and has been reset to an unsubmitted state, by stripping the extract number, status, and download links from the original extract. The revised extract can then be submitted with:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">newly_submitted_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="va">new_extract</span><span class="op">)</span></code></pre></div>
</div>
<div id="recent" class="section level1">
<h1 class="hasAnchor">
<a href="#recent" class="anchor"></a>Getting info on multiple recent extracts</h1>
<p>You can query the API for the details and status of up to ten recent extracts using the functions <code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list()</a></code> and <code><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl()</a></code>. The <code>_list</code> version of the function returns a list of “ipums_extract” objects, whereas the <code>_tbl</code> version returns a tibble (enhanced “data.frame”) in which each row contains information on one extract.</p>
<p>The list representation is useful if you want to be able to operate on elements as “ipums_extract” objects. For instance, to retrieve your most second-most-recent extract and revise it for resubmission, you could use:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">second_most_recent_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>
<span class="va">revised_extract</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/revise_extract.html">revise_extract</a></span><span class="op">(</span>
  <span class="va">second_most_recent_extract</span>, 
  samples_to_add <span class="op">=</span> <span class="st">"us2010a"</span>
<span class="op">)</span></code></pre></div>
<p>Or to download all recent extracts that are ready to download, using <code><a href="https://purrr.tidyverse.org/reference/keep.html">purrr::keep()</a></code> and <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_chr()</a></code>:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ddi_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/keep.html">keep</a></span><span class="op">(</span><span class="va">is_extract_ready</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_chr</a></span><span class="op">(</span><span class="va">download_extract</span><span class="op">)</span></code></pre></div>
<p>The tibble representation is useful if you want to use functions for manipulating data.frames to find recent extracts matching particular criteria.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span></code></pre></div>
<p>For example, to find extracts with descriptions including the word “occupation”, you could use:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span><span class="op">(</span><span class="st">"occupation"</span>, <span class="va">description</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Filtering on properties such as “samples” or “variables” is a little more complex, because these are stored in list columns, but it is possible. For example, to find extracts including the variable “AGE”, you could use <code><a href="https://purrr.tidyverse.org/reference/map.html">purrr::map_lgl()</a></code> like this:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">recent_usa_extracts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html">map_lgl</a></span><span class="op">(</span><span class="va">variables</span>, <span class="op">~</span><span class="st">"AGE"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="va">.x</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To convert between these two representations, ipumsr provides the functions <code><a href="../reference/extract_list_to_tbl.html">extract_list_to_tbl()</a></code> and <code><a href="../reference/extract_tbl_to_list.html">extract_tbl_to_list()</a></code>, such that the following is <code>TRUE</code>:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/identical.html">identical</a></span><span class="op">(</span>
  <span class="fu"><a href="../reference/extract_list_to_tbl.html">extract_list_to_tbl</a></span><span class="op">(</span><span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_list</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span><span class="op">)</span>,
  <span class="fu"><a href="../reference/get_recent_extracts_info.html">get_recent_extracts_info_tbl</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
</div>
<div id="putting-it-all-together-with-pipes" class="section level1">
<h1 class="hasAnchor">
<a href="#putting-it-all-together-with-pipes" class="anchor"></a>Putting it all together, with pipes</h1>
<p>The return values of the functions to interact with the API are configured in such a way that you can define, submit, wait for, download, and read in your extract all in one piped expression:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/define_extract.html">define_extract</a></span><span class="op">(</span>
    <span class="st">"usa"</span>,
    <span class="st">"Extract for API vignette"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"us2018a"</span>,<span class="st">"us2019a"</span><span class="op">)</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"AGE"</span>,<span class="st">"SEX"</span>,<span class="st">"RACE"</span>,<span class="st">"STATEFIP"</span><span class="op">)</span>
  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/submit_extract.html">submit_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/wait_for_extract.html">wait_for_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/download_extract.html">download_extract</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> 
    <span class="fu"><a href="../reference/read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
