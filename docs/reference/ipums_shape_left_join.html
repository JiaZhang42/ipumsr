<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Join data to geographic boundaries — ipums_shape_left_join • ipumsr</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><!-- docsearch --><script src="../docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous"><link href="../docsearch.css" rel="stylesheet"><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><meta property="og:title" content="Join data to geographic boundaries — ipums_shape_left_join"><meta property="og:description" content="Helpers for joining shape files downloaded from the IPUMS website to data from extracts.
Because of historical reasons, the attributes of (like variable type) of variables
in the shape files does not always match those in the data files."><meta property="og:image" content="http://tech.popdata.org/ipumsr/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ipumsr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ipums.html">Intro</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/ipums.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/value-labels.html">Value labels</a>
    </li>
    <li>
      <a href="../articles/ipums-geography.html">Geographic data in ipumsr</a>
    </li>
    <li>
      <a href="../articles/ipums-bigdata.html">Big IPUMS data</a>
    </li>
    <li>
      <a href="../articles/ipums-api.html">IPUMS data extract API</a>
    </li>
    <li class="divider">
    <li>
      <a href="../articles/ipums-cps.html">CPS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-nhgis.html">NHGIS exercise</a>
    </li>
    <li>
      <a href="../articles/ipums-terra.html">IPUMS Terra exercise</a>
    </li>
    <li>
      <a href="https://ipums.org/exercises.shtml" class="external-link">More project exercises</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/ipums/ipumsr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
<li>
  <a href="https://forum.ipums.org" class="external-link">
    <span class="fa fa-users"></span>
     
  </a>
</li>
<li>
  <a href="https://www.ipums.org/" class="external-link">
    <span class="fa fa-globe"></span>
     
  </a>
</li>
      </ul><form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off"></div>
      </form>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Join data to geographic boundaries</h1>
    <small class="dont-index">Source: <a href="https://github.com/ipums/ipumsr/blob/HEAD/R/shape_join.r" class="external-link"><code>R/shape_join.r</code></a></small>
    <div class="hidden name"><code>ipums_shape_left_join.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Helpers for joining shape files downloaded from the IPUMS website to data from extracts.
Because of historical reasons, the attributes of (like variable type) of variables
in the shape files does not always match those in the data files.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">ipums_shape_left_join</span><span class="op">(</span>
  <span class="va">data</span>,
  <span class="va">shape_data</span>,
  <span class="va">by</span>,
  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"SHAPE"</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="fu">ipums_shape_right_join</span><span class="op">(</span>
  <span class="va">data</span>,
  <span class="va">shape_data</span>,
  <span class="va">by</span>,
  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"SHAPE"</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="fu">ipums_shape_inner_join</span><span class="op">(</span>
  <span class="va">data</span>,
  <span class="va">shape_data</span>,
  <span class="va">by</span>,
  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"SHAPE"</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="fu">ipums_shape_full_join</span><span class="op">(</span>
  <span class="va">data</span>,
  <span class="va">shape_data</span>,
  <span class="va">by</span>,
  suffix <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">""</span>, <span class="st">"SHAPE"</span><span class="op">)</span>,
  verbose <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A dataset, usually one that has been aggregated to a geographic level.</p></dd>


<dt>shape_data</dt>
<dd><p>A shape file (loaded with <code><a href="read_ipums_sf.html">read_ipums_sf</a></code> or <code>read_ipums_sp</code>)</p></dd>


<dt>by</dt>
<dd><p>A vector of variable names to join on. Like the dplyr join functions, named vectors
 indicate that the names are different between the data and shape file.
 shape files to load. Accepts a character vector specifying the file name, or
<code><a href="dplyr_select_style.html">dplyr_select_style</a></code> conventions. Can load multiple shape files,
  which will be combined.</p></dd>


<dt>suffix</dt>
<dd><p>For variables that are found in both, but aren't joined on, a suffix
to put on the variables. Defaults to nothing for data variables and "_SHAPE" for
variables from the shape file.</p></dd>


<dt>verbose</dt>
<dd><p>I <code>TRUE</code>, will report information about geometries dropped in the merge.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>returns a sf or a SpatialPolygonsDataFrame depending on what was passed in.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="co"># Note that these examples use NHGIS data so that they use the example data provided,</span></span>
<span class="r-in"><span class="co"># but the functions read_nhgis_sf/read_nhgis_sp perform this merge for you.</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_nhgis.html">read_nhgis</a></span><span class="op">(</span><span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"nhgis0008_csv.zip"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Use of data from NHGIS is subject to conditions including that users should</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> cite the data appropriately. Use command `ipums_conditions()` for more details.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reading data file...</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_ipums_sf.html">read_ipums_sf</a></span><span class="op">(</span><span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"nhgis0008_shape_small.zip"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">data_sf</span> <span class="op">&lt;-</span> <span class="fu">ipums_shape_inner_join</span><span class="op">(</span><span class="va">data</span>, <span class="va">sf</span>, by <span class="op">=</span> <span class="st">"GISJOIN"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: sf</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Linking to GEOS 3.10.2, GDAL 3.4.2, PROJ 8.2.1; sf_use_s2() is TRUE</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> options:        ENCODING=latin1 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Reading layer `US_pmsa_1990' from data source </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   `/private/var/folders/bp/l9qm36b10bq0jfwtkvty8q5h0000gq/T/Rtmp5RveN8/file2acb2335330d/US_pmsa_1990.shp' </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   using driver `ESRI Shapefile'</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Simple feature collection with 71 features and 8 fields</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Geometry type: MULTIPOLYGON</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Dimension:     XY</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Bounding box:  xmin: -2336182 ymin: -1247086 xmax: 2075339 ymax: 1476544</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Projected CRS: Albers</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/edzer/sp/" class="external-link">sp</a></span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://rgdal.r-forge.r-project.org" class="external-link">rgdal</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="va">sp</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_ipums_sf.html">read_ipums_sp</a></span><span class="op">(</span><span class="fu"><a href="ipums_example.html">ipums_example</a></span><span class="op">(</span><span class="st">"nhgis0008_shape_small.zip"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">data_sp</span> <span class="op">&lt;-</span> <span class="fu">ipums_shape_inner_join</span><span class="op">(</span><span class="va">data</span>, <span class="va">sp</span>, by <span class="op">=</span> <span class="st">"GISJOIN"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: sp</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: rgdal</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Please note that rgdal will be retired by the end of 2023,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> plan transition to sf/stars/terra functions using GDAL and PROJ</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> at your earliest convenience.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rgdal: version: 1.5-31, (SVN revision 1171)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Geospatial Data Abstraction Library extensions to R successfully loaded</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loaded GDAL runtime: GDAL 3.4.2, released 2022/03/08</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Path to GDAL shared files: /Users/robe2037/Library/R/arm64/4.2/library/rgdal/gdal</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> GDAL binary built with GEOS: FALSE </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loaded PROJ runtime: Rel. 8.2.1, January 1st, 2022, [PJ_VERSION: 821]</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Path to PROJ shared files: /Users/robe2037/Library/R/arm64/4.2/library/rgdal/proj</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> PROJ CDN enabled: FALSE</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Linking to sp version:1.4-7</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> To mute warnings of possible GDAL/OSR exportToProj4() degradation,</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> use options("rgdal_show_exportToProj4_warnings"="none") before loading sp or rgdal.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OGR data source with driver: ESRI Shapefile </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Source: "/private/var/folders/bp/l9qm36b10bq0jfwtkvty8q5h0000gq/T/Rtmp5RveN8/file2acb79aaac89", layer: "US_pmsa_1990"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> with 71 features</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> It has 8 fields</span>
<span class="r-in"></span>
<span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in">  <span class="co"># Sometimes variable names won't match between datasets (for example in IPUMS international)</span></span>
<span class="r-in">  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_ipums_micro.html">read_ipums_micro</a></span><span class="op">(</span><span class="st">"ipumsi_00004.xml"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">shape</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_ipums_sf.html">read_ipums_sf</a></span><span class="op">(</span><span class="st">"geo2_br1980_2010.zip"</span><span class="op">)</span></span>
<span class="r-in">  <span class="va">data_sf</span> <span class="op">&lt;-</span> <span class="fu">ipums_shape_inner_join</span><span class="op">(</span><span class="va">data</span>, <span class="va">shape</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"GEO2"</span> <span class="op">=</span> <span class="st">"GEOLEVEL2"</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.ipums.org" class="external-link">IPUMS</a> at the University of Minnesota.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> .</p>
</div>

      </footer></div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '4ffa912ace97d2493f6ed39f20e94316',
    indexName: 'ipumsr',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script></body></html>

