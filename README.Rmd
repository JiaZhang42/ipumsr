---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# ripums #
[![Project Status: WIP â€“ Initial development is in progress, but there has not yet been a stable, usable release suitable for the public.](http://www.repostatus.org/badges/latest/wip.svg)](http://www.repostatus.org/#wip)
[![CRAN_Status_Badge](http://www.r-pkg.org/badges/version/ripums)](http://cran.r-project.org/web/packages/ripums) 

The ripums package helps import IPUMS extracts from the [IPUMS website](https://www.ipums.org) 
into R. This project is early in its development, and so we expect there may be bugs and future
API changes that break code. We hope to post a more stable version on CRAN soon.

The ripums package can be installed by running the following commands:
```{r, eval=FALSE}
if (!require(devtools)) install.packages("devtools")

devtools::install_github("mnpopcenter/ripums")

# MPC staff can install using local files 
if (Sys.info()["sysname"] == "Windows") {
  devtools::install_local("Z:/personal/gfellis/ripums")
} else {
  devtools::install_local("/pkg/ipums/personal/gfellis/ripums")
}
```

## Examples ##
Example extracts are included in the 'ripumstest' package, which can be installed 
using the following comands:
```{r, eval=FALSE}
devtools::install_github("mnpopcenter/ripumstest")

# MPC staff can install using local files 
if (Sys.info()["sysname"] == "Windows") {
  devtools::install_local("Z:/personal/gfellis/ripumstest")
} else {
  devtools::install_local("/pkg/ipums/personal/gfellis/ripumstest")
}
```

```{r}
suppressPackageStartupMessages({
  library(ripums)
  library(haven)
  library(ggplot2) # ggplot2 version > 2.2.1 (development version as of 8/15/2017)
  library(dplyr)
  library(sf)
})
```

### CPS - Hierarchical Data ###
Relies on user downloading the .xml DDI file and the .dat/.dat.gz file (doesn't need to be unzipped).
```{r}
# Use example file included with package:
cps_hier_file <- ripums_example("cps_00010.xml")
data <- read_ipums_micro(cps_hier_file)

cat(ipums_var_desc(data, MONTH))
table(as_factor(data$MONTH, levels = "both"))
```


### CPS - Rectangular Data ###
Relies on user downloading the .xml DDI file and the .dat/.dat.gz file (doesn't need to be unzipped).
```{r, eval = FALSE}
# Use example file included with package
cps_rect_file <- ripums_example("cps_00006.xml")
data <- read_ipums_micro(cps_rect_file, verbose = FALSE)

# While working interactively, can get convenient display of variable information
# in RStudio's viewer
ipums_view(data)
```

### NHGIS ###
Relies on user downloading the csv file (with or without header row) and shape files (doesn't need to be unzipped).
```{r}
data <- read_nhgis(
  ripums_example("nhgis0008_csv.zip"),
  ripums_example("nhgis0008_shape.zip"),
  verbose = FALSE
)

ipums_var_info(data, starts_with("D6Z"))

data <- data %>%
  mutate(
    pct_before_1950 = (D6Z007 + D6Z008) / 
           (D6Z001 + D6Z002 + D6Z003 + D6Z004 + D6Z005 + D6Z006 + D6Z007 + D6Z008)
  )

ggplot(data = data) + 
  geom_sf(aes(fill = pct_before_1950)) + 
  ggtitle(
    "Percent of homes built before 1950", 
    subtitle = "By Primary Metropolitan Statistical Area in 1990 Census"
  )
```

### Terrapop ###
Also have functions for loading terrapop data, but examples are too large to include in the package.
```{r, eval=FALSE}
# Raster data
data <- read_terra_raster(
  "2552_bundle.zip",
  "CROPLAND2000ZM2013.tiff",
  verbose = FALSE
)

# Area data
data <- read_terra_area(
  "2553_bundle.zip",
  verbose = FALSE
)

# Microdata
data <- read_terra_micro(
  "2554_bundle.zip",
  verbose = FALSE
)

```
