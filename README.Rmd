---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, echo = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "README-"
)
```

# ipumsimport #
The ipumsimport package helps import IPUMS extracts from the [website](https://www.ipums.org) 
into R. Currently it only works with microdata projects and has been tested with both
rectangular and hierarchical data for CPS and IPUMS-I.

It can be installed by running the following commands:
```{r, eval=FALSE}
if (!require(devtools)) install.packages("devtools")

if (Sys.info()$sysname == "Windows") {
  devtools::install_local("Z:/personal/gfellis/ipumsimport")
} else {
  devtools::install_local("/pkg/ipums/personal/gfellis/ipumsimport")
}
```

## Examples ##
```{r}
library(ipumsimport)
library(mpctools)
library(haven)
library(ggplot2)
library(dplyr)
```

### CPS - Hierarchical Data ###
Relies on user downloading the .xml DDI file and the .dat/.dat.gz file (doesn't need to be unzipped).
```{r}
data <- ip_read_data(mpc_root("personal/gfellis/ipumsimport_examples/cps_hier/cps_00004.xml"))

cat(attr(data$TCIG100, "label_long"))
table(as_factor(data$TCIG100, levels = "both"))
```


### CPS - Rectangular Data ###
Relies on user downloading the .xml DDI file and the .dat/.dat.gz file (doesn't need to be unzipped).
```{r}
data <- ip_read_data(mpc_root("personal/gfellis/ipumsimport_examples/cps_rect/cps_00003.xml"), verbose = FALSE)

cat(attr(data$TCIG100, "label_long"))
table(as_factor(data$TCIG100, levels = "both"))
```

### NHGIS ###
Relies on user downloading the csv file (with header row) and shape files.
```{r}
data <- ip_read_nhgis(
  mpc_root("personal/gfellis/ipumsimport_examples/nhgis/nhgis0005_csv.zip"),
  mpc_root("personal/gfellis/ipumsimport_examples/nhgis/nhgis0005_shape.zip"),
  "state",
  "state",
  verbose = FALSE
)

data <- data %>%
  mutate(pct_slave = (ABO003 + ABO005) / (ABO001 + ABO002 + ABO003 + ABO004 + ABO005 + ABO006))

ggplot(data = data) + 
  geom_sf(aes(fill = pct_slave))
```

### Terrapop - Raster Data ###
Relies on zip file from extract
```{r}
data <- ip_read_terra_raster(
  mpc_root("personal/gfellis/ipumsimport_examples/terra_raster/2552_bundle.zip"),
  "CROPLAND2000ZM2013"
)

raster::plot(data)
```

### Terrapop - Area level data ###
Relies on zip file from extract (with boundary files for maps)
```{r}
data <- ip_read_terra_area(
  mpc_root("personal/gfellis/ipumsimport_examples/terra_area/2553_bundle.zip")
)

ggplot(data) +
  geom_sf(aes(fill = EDUCTERTIARY_GEO1_BR_BR2010A))
```

### Terrapop - Microlevel data ###
Relies on zip file from extract (with boundary files for maps)
This file is huge, so won't run on a local machine, but I need IT's help getting some
dependcies set-up to run this on the mpcstats servers.

